<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <style>
        body {
            background-color: #222;
            font-family: "Lato", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            color: #fff;
            margin: 0px;
            height: 100vh;
        }

        input {
            resize: none;
            background-color: #375a7f;
            color: #fff;
            border: 0px;
            font-family: inherit;
            padding-left: 2px;
        }

        select {
            background-color: #375a7f;
            color: #fff;
            border: 0px;
            width: 20%;
        }

        button {
            font-family: inherit;
            font-size: inherit;
        }

        button.fieldTitle {
            width: 100%;
        }

        .disclaimer {
            text-align: center;
            margin: auto;
        }

        .disclaimer>.accordion {
            width: auto;
        }

        .multioption {
            display: inline-flex !important;
            position: relative;
        }

        .multioption.selected {
            background-color: #00bc8c;
        }

        .multioption .fieldTitle {
            width: auto;
        }

        .multioption input[type=checkbox] {
            opacity: 0;
            position: absolute;
            cursor: inherit;
        }

        .tabs {
            height: 45px;
        }

        .tab {
            width: 20% !important;
            text-align: center !important;
            height: 100%;
            font-size: 1.5em;
        }

        .tabcontent {
            display: none;
            background-color: #28415b;
            padding: 5px;
            height: calc(100% - 45px - 10px);
            overflow-y: auto;
        }

        .accordion {
            background-color: #375a7f;
            color: #fff;
            cursor: pointer;
            padding: 5px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
        }

        .active,
        .accordion:hover {
            background-color: #28415b;
        }

        .panel {
            display: none;
            padding: 2px 5px;
        }

        .charContainer {
            display: flex;
            height: 100%;
        }

        .charList {
            display: grid;
            width: 100px;
        }

        .charDesc {
            display: block;
            width: calc(100% - 100px);
            height: inherit;
            overflow-y: hidden;
        }

        .topTagButtons {
            display: flex;
        }

        .topTagButton {
            text-align: center;
        }

        .topTagPanels {
            height: inherit;
            overflow-y: auto;
        }

        .fieldEntry {
            display: flex;
            width: auto !important;
        }

        .fieldEntry fieldset {
            margin: unset;
            border: unset;
            padding: unset;
            width: 80%;
        }

        .fieldTitle {
            width: 20%;
            font-family: "Lato", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            color: #fff;
            font-size: 1em;
        }

        .addRemoveButtons {
            display: flex;
        }

        .addRemoveButton {
            width: 1em;
            text-align: center;
        }
    </style>
    <script>

        // Command for serializing default chars
        // JSON.stringify(Object.entries(window.CHAR_CLASSES).filter(char=>["PlayerCharacter", "Arona", "Berwyn", "Brint", "Cait", "Kiyoko", "Etheryn"].some(n=>n===char[0])).reduce((obj, char)=>{obj[char[0]]=(new char[1]()).serialize();return obj},{}));

        var charDefaults = {
            "pc":{"name":"Unnamed","cName":"","soloCombatPrefix":"","taxa":1,"class":0,"background":0,"isPlural":false,"partyLeader":true,"level":1,"exp":0,"canGainExp":false,"compTags":[],"actionPoints":1,"hitPoints":100,"hitPointsMaxMod":0,"resolvePoints":100,"resolveMaxMod":0,"threatMod":10,"strengthAlloc":0,"strengthMod":0,"toughnessAlloc":0,"toughnessMod":0,"agilityAlloc":0,"agilityMod":0,"cunningAlloc":0,"cunningMod":0,"willpowerAlloc":0,"willpowerMod":0,"presenceAlloc":0,"presenceMod":0,"libidoMod":0,"corruptionMod":0,"isLustImmune":false,"penetratingResist":0,"crushingResist":0,"holyResist":0,"blightResist":0,"acidResist":0,"fireResist":0,"frostResist":0,"stormResist":0,"teaseResist":0,"drugResist":0,"pheromoneResist":0,"fatigueResist":0,"mindResist":0,"raceAffinities":[],"classAffinities":[],"backgroundAffinities":[],"perks":[],"powers":[],"equippedPowers":[null,null,null,null,null],"stance":null,"multiTurnAttack":null,"combatEffects":[],"statusEffects":[],"likes":[],"dislikes":[],"boon":null,"credits":0,"weaponPrimary":{"key":"Fist","args":[1]},"weaponSecondary":null,"backupFist":{"_name":"fist","_short":"Fist","_description":"Ideal for taking care of arguments and needy holes alike.","isPlural":false,"stackLimit":1,"stack":1,"type":1,"tags":[2,6],"value":1,"evasion":0,"accuracy":10,"spellpower":0,"crit":0,"armorPen":0,"damage":{"attackType":1,"damage":[{"type":2,"amount":5}]}},"head":null,"neck":null,"shoulders":null,"armorSet":{"key":"ComfortableClothes","args":[1]},"hands":null,"waist":null,"feet":{"key":"LeatherBoots","args":[1]},"ring1":null,"ring2":null,"topGarment":null,"bottomGarment":{"key":"PlainUnderwear","args":[1]},"inventory":[],"keyItems":[],"set":null,"originalRace":"human","femininity":50,"tallness":66,"tone":50,"thickness":50,"hipRatingRaw":0,"hipRatingMod":0,"buttRatingRaw":0,"buttRatingMod":0,"bellyRatingRaw":0,"bellyRatingMod":0,"lipMod":0,"hairColor":"brown","skinColor":"","furColor":"brown","scaleColor":"","lipColor":"peach","hairLength":2,"hairStyle":"","hairType":1,"horns":0,"hornType":-1,"hornLength":0,"wingType":-1,"wingCount":0,"skinType":6,"skinTags":[],"tailType":-1,"numTails":0,"tailTags":[],"armType":1,"armTags":[],"legCount":2,"legType":1,"legTags":[],"tongueType":1,"tongueTags":[],"faceType":1,"faceTags":[],"earType":1,"earTags":[],"earLength":0,"eyeType":1,"eyeTags":[],"eyeColor":"brown","orgasms":0,"lastOrgasm":0,"exhibRaw":0,"isVirgin":true,"vaginalVirgin":true,"cockVirgin":true,"analVirgin":true,"pregnancySpeedRaw":1,"pregnancySpeedMod":0,"breastRows":[{"breasts":2,"type":7,"tags":[],"sizeRaw":0,"sizeMod":0,"lactationBonusMod":0,"fullnessRaw":0}],"nippleColor":"pink","nipplesPerBreast":1,"nippleLengthRatio":1,"nippleWidthRatio":1,"milkType":4,"milkMultiplier":0,"milkStorageMultiplier":1,"milkFullness":0,"milkRate":10,"balls":0,"ballTags":[],"ballEfficiency":1,"ballSizeRaw":3,"ballSizeMod":0,"ballFullness":100,"cocks":[],"feracityRaw":1,"feracityMod":0,"vagina":null,"clitLength":0.5,"girlCumType":1,"cumType":2,"cumMultiplierRaw":1,"cumMultiplierMod":0,"ass":{"type":1,"hymen":false,"clits":0,"color":"pink","wetnessRaw":0,"wetnessMod":0,"loosenessRaw":1,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"reagents":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"defaultCockIdx":0,"lastRingSlotEquipped":2,"lastRechargeEquipped":2,"title":"Adventurer","wyldMark":-1,"drinks":[],"customImage":null,"pendingLoot":[],"sensed":[],"storage":[],"maxStorage":200},
            "arona":{"name":"Arona","cName":"","soloCombatPrefix":"","taxa":1,"class":1,"background":5,"genderPref":1,"isPlural":false,"partyLeader":true,"level":3,"exp":150,"canGainExp":true,"compTags":[2],"actionPoints":1,"hitPoints":200,"hitPointsMaxMod":0,"resolvePoints":100,"resolveMaxMod":0,"threatMod":10,"strengthAlloc":2,"strengthMod":0,"toughnessAlloc":2,"toughnessMod":1,"agilityAlloc":0,"agilityMod":0,"cunningAlloc":1,"cunningMod":2,"willpowerAlloc":1,"willpowerMod":1,"presenceAlloc":0,"presenceMod":0,"libidoMod":10,"corruptionMod":0,"isLustImmune":false,"penetratingResist":0,"crushingResist":0,"holyResist":0,"blightResist":0,"acidResist":0,"fireResist":0,"frostResist":0,"stormResist":0,"teaseResist":0,"drugResist":0,"pheromoneResist":0,"fatigueResist":0,"mindResist":0,"raceAffinities":[1,0,4],"classAffinities":[1,0,2],"backgroundAffinities":[0,1,5],"perks":[{"key":"WarPaint","values":[]},{"key":"StartingAttributeBonuses","values":[0,3,0,0,0,0]}],"powers":[{"key":"NormalAttack"},{"key":"NormalAttack"},{"key":"GuardedStance"},{"key":"AmazonStrike"},{"key":"Cleave"},{"key":"PrimeTarget"}],"equippedPowers":[{"key":"GuardedStance"},{"key":"AmazonStrike"},{"key":"Cleave"},{"key":"PrimeTarget"},null],"stance":null,"multiTurnAttack":null,"combatEffects":[],"statusEffects":[],"likes":[-9,-4],"dislikes":[-8,-3],"boon":null,"credits":60,"weaponPrimary":{"key":"Mastbreaker","args":[1]},"weaponSecondary":{"key":"HoplonShield","args":[1]},"backupFist":{"_name":"fist","_short":"Fist","_description":"Ideal for taking care of arguments and needy holes alike.","isPlural":false,"stackLimit":1,"stack":1,"type":1,"tags":[2,6],"value":1,"evasion":0,"accuracy":10,"spellpower":0,"crit":0,"armorPen":0,"damage":{"attackType":1,"damage":[{"type":2,"amount":5}]}},"head":null,"neck":null,"shoulders":null,"armorSet":{"key":"AronasWarhides","args":[1]},"hands":null,"waist":null,"feet":null,"ring1":null,"ring2":null,"topGarment":null,"bottomGarment":null,"inventory":[],"keyItems":[],"set":null,"originalRace":"orc","femininity":70,"tallness":94,"tone":80,"thickness":30,"hipRatingRaw":12,"hipRatingMod":0,"buttRatingRaw":8,"buttRatingMod":0,"bellyRatingRaw":8,"bellyRatingMod":0,"lipMod":0,"hairColor":"black","skinColor":"green","furColor":"brown","scaleColor":"","lipColor":"black","hairLength":2,"hairStyle":"","hairType":1,"horns":0,"hornType":-1,"hornLength":0,"wingType":-1,"wingCount":0,"skinType":6,"skinTags":[],"tailType":-1,"numTails":0,"tailTags":[],"armType":1,"armTags":[],"legCount":2,"legType":1,"legTags":[],"tongueType":1,"tongueTags":[],"faceType":2,"faceTags":[27],"earType":5,"earTags":[3],"earLength":1,"eyeType":1,"eyeTags":[],"eyeColor":"brown","orgasms":0,"lastOrgasm":0,"exhibRaw":0,"isVirgin":false,"vaginalVirgin":true,"cockVirgin":false,"analVirgin":false,"pregnancySpeedRaw":1,"pregnancySpeedMod":0,"breastRows":[{"breasts":2,"type":7,"tags":[],"sizeRaw":5,"sizeMod":0,"lactationBonusMod":0,"fullnessRaw":0}],"nippleColor":"black","nipplesPerBreast":1,"nippleLengthRatio":1,"nippleWidthRatio":1,"milkType":4,"milkMultiplier":0,"milkStorageMultiplier":1,"milkFullness":0,"milkRate":10,"balls":0,"ballTags":[],"ballEfficiency":1,"ballSizeRaw":3,"ballSizeMod":0,"ballFullness":100,"cocks":[{"type":1,"virgin":true,"tags":[],"lengthRaw":12,"lengthMod":0,"thicknessRatioRaw":1,"thicknessRatioMod":0,"flaccidRatio":0.4,"knotRatio":1,"pierced":0,"color":"green"}],"feracityRaw":1,"feracityMod":0,"vagina":{"type":1,"hymen":true,"clits":1,"color":"black","wetnessRaw":1,"wetnessMod":0,"loosenessRaw":1.5,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"clitLength":0.5,"girlCumType":1,"cumType":2,"cumMultiplierRaw":1,"cumMultiplierMod":0,"ass":{"type":1,"hymen":false,"clits":0,"color":"pink","wetnessRaw":0,"wetnessMod":0,"loosenessRaw":1,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"reagents":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"defaultCockIdx":0,"lastRingSlotEquipped":2,"lastRechargeEquipped":2},
            "berwyn":{"name":"Summoner","cName":"","soloCombatPrefix":"the ","taxa":1,"class":4,"background":6,"genderPref":0,"isPlural":false,"partyLeader":false,"level":2,"exp":150,"canGainExp":true,"compTags":[4],"actionPoints":1,"hitPoints":130,"hitPointsMaxMod":0,"resolvePoints":100,"resolveMaxMod":0,"threatMod":10,"strengthAlloc":0,"strengthMod":0,"toughnessAlloc":0,"toughnessMod":0,"agilityAlloc":0,"agilityMod":0,"cunningAlloc":1,"cunningMod":1,"willpowerAlloc":1,"willpowerMod":1,"presenceAlloc":1,"presenceMod":0,"libidoMod":0,"corruptionMod":0,"isLustImmune":false,"penetratingResist":0,"crushingResist":0,"holyResist":0,"blightResist":0,"acidResist":0,"fireResist":0,"frostResist":0,"stormResist":0,"teaseResist":0,"drugResist":0,"pheromoneResist":0,"fatigueResist":0,"mindResist":0,"raceAffinities":[0,1,3],"classAffinities":[4,3,5],"backgroundAffinities":[3,4,5],"perks":[{"key":"StartingAttributeBonuses","values":[1,0,0,1,1,0]}],"powers":[{"key":"NormalAttack"},{"key":"FireBolt"},{"key":"CharmSpell"},{"key":"Heal"},{"key":"SummonStoneElemental"}],"equippedPowers":[null,null,null,null,null],"stance":null,"multiTurnAttack":null,"combatEffects":[],"statusEffects":[],"likes":[-14,-10,-17,-9],"dislikes":[-4,-8],"boon":null,"credits":100,"weaponPrimary":{"key":"Quarterstaff","args":[1]},"weaponSecondary":null,"backupFist":{"_name":"fist","_short":"Fist","_description":"Ideal for taking care of arguments and needy holes alike.","isPlural":false,"stackLimit":1,"stack":1,"type":1,"tags":[2,6],"value":1,"evasion":0,"accuracy":10,"spellpower":0,"crit":0,"armorPen":0,"damage":{"attackType":1,"damage":[{"type":2,"amount":5}]}},"head":null,"neck":null,"shoulders":null,"armorSet":{"key":"ApprenticeRobes","args":[1]},"hands":null,"waist":null,"feet":null,"ring1":null,"ring2":null,"topGarment":null,"bottomGarment":null,"inventory":[],"keyItems":[],"set":null,"originalRace":"lupine","femininity":70,"tallness":66,"tone":30,"thickness":5,"hipRatingRaw":10,"hipRatingMod":0,"buttRatingRaw":10,"buttRatingMod":0,"bellyRatingRaw":2,"bellyRatingMod":0,"lipMod":0,"hairColor":"white","skinColor":"brown","furColor":"brown","scaleColor":"","lipColor":"peach","hairLength":2,"hairStyle":"","hairType":1,"horns":0,"hornType":-1,"hornLength":0,"wingType":-1,"wingCount":0,"skinType":6,"skinTags":[],"tailType":-1,"numTails":0,"tailTags":[],"armType":1,"armTags":[],"legCount":2,"legType":1,"legTags":[],"tongueType":1,"tongueTags":[],"faceType":1,"faceTags":[],"earType":1,"earTags":[],"earLength":0,"eyeType":1,"eyeTags":[],"eyeColor":"brown","orgasms":0,"lastOrgasm":0,"exhibRaw":0,"isVirgin":false,"vaginalVirgin":true,"cockVirgin":false,"analVirgin":false,"pregnancySpeedRaw":1,"pregnancySpeedMod":0,"breastRows":[{"breasts":2,"type":7,"tags":[],"sizeRaw":0,"sizeMod":0,"lactationBonusMod":0,"fullnessRaw":0}],"nippleColor":"pink","nipplesPerBreast":1,"nippleLengthRatio":1,"nippleWidthRatio":1,"milkType":4,"milkMultiplier":0,"milkStorageMultiplier":1,"milkFullness":0,"milkRate":10,"balls":0,"ballTags":[],"ballEfficiency":1,"ballSizeRaw":3,"ballSizeMod":0,"ballFullness":100,"cocks":[],"feracityRaw":1,"feracityMod":0,"vagina":null,"clitLength":0.5,"girlCumType":1,"cumType":2,"cumMultiplierRaw":1,"cumMultiplierMod":0,"ass":{"type":1,"hymen":false,"clits":0,"color":"pink","wetnessRaw":0,"wetnessMod":0,"loosenessRaw":1,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"reagents":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"defaultCockIdx":0,"lastRingSlotEquipped":2,"lastRechargeEquipped":2},
            "brint":{"name":"Brint","cName":"","soloCombatPrefix":"","taxa":2,"class":1,"background":3,"genderPref":0,"isPlural":false,"partyLeader":false,"level":1,"exp":0,"canGainExp":true,"compTags":[2],"actionPoints":1,"hitPoints":110,"hitPointsMaxMod":0,"resolvePoints":100,"resolveMaxMod":0,"threatMod":10,"strengthAlloc":0,"strengthMod":2,"toughnessAlloc":0,"toughnessMod":1,"agilityAlloc":0,"agilityMod":1,"cunningAlloc":0,"cunningMod":0,"willpowerAlloc":0,"willpowerMod":0,"presenceAlloc":0,"presenceMod":0,"libidoMod":15,"corruptionMod":0,"isLustImmune":false,"penetratingResist":0,"crushingResist":0,"holyResist":0,"blightResist":-75,"acidResist":0,"fireResist":0,"frostResist":0,"stormResist":0,"teaseResist":0,"drugResist":0,"pheromoneResist":-75,"fatigueResist":0,"mindResist":0,"raceAffinities":[1,0,2],"classAffinities":[1,0,2],"backgroundAffinities":[0,1,2],"perks":[{"key":"StartingAttributeBonuses","values":[2,1,0,0,0,0]},{"key":"RendingStrike","values":[]}],"powers":[{"key":"NormalAttack"},{"key":"GiantsReach"},{"key":"Cleave"},{"key":"Frenzy"}],"equippedPowers":[{"key":"GiantsReach"},{"key":"Cleave"},null,{"key":"Frenzy"},null],"stance":null,"multiTurnAttack":null,"combatEffects":[],"statusEffects":[],"likes":[-14,-10,-17,-9],"dislikes":[-1,-7],"boon":null,"credits":0,"weaponPrimary":{"key":"Poleaxe","args":[1]},"weaponSecondary":{"key":"Mace","args":[1]},"backupFist":{"_name":"fist","_short":"Fist","_description":"Ideal for taking care of arguments and needy holes alike.","isPlural":false,"stackLimit":1,"stack":1,"type":1,"tags":[2,6],"value":1,"evasion":0,"accuracy":10,"spellpower":0,"crit":0,"armorPen":0,"damage":{"attackType":1,"damage":[{"type":2,"amount":5}]}},"head":null,"neck":null,"shoulders":null,"armorSet":{"key":"LoinclothAndGuards","args":[1]},"hands":null,"waist":null,"feet":null,"ring1":null,"ring2":null,"topGarment":null,"bottomGarment":null,"inventory":[],"keyItems":[],"set":{"key":"LoinSet","args":[1]},"originalRace":"minotaur","femininity":5,"tallness":102,"tone":80,"thickness":5,"hipRatingRaw":2,"hipRatingMod":0,"buttRatingRaw":3,"buttRatingMod":0,"bellyRatingRaw":1,"bellyRatingMod":0,"lipMod":0,"hairColor":"dark brown","skinColor":"brown","furColor":"brown","scaleColor":"","lipColor":"black","hairLength":2,"hairStyle":"","hairType":1,"horns":0,"hornType":-1,"hornLength":0,"wingType":-1,"wingCount":0,"skinType":4,"skinTags":[],"tailType":22,"numTails":1,"tailTags":[],"armType":1,"armTags":[],"legCount":2,"legType":22,"legTags":[26,34,37],"tongueType":22,"tongueTags":[],"faceType":22,"faceTags":[24],"earType":22,"earTags":[],"earLength":0,"eyeType":1,"eyeTags":[],"eyeColor":"brown","orgasms":0,"lastOrgasm":0,"exhibRaw":0,"isVirgin":false,"vaginalVirgin":true,"cockVirgin":false,"analVirgin":false,"pregnancySpeedRaw":1,"pregnancySpeedMod":0,"breastRows":[{"breasts":2,"type":7,"tags":[],"sizeRaw":0,"sizeMod":0,"lactationBonusMod":0,"fullnessRaw":0}],"nippleColor":"pink","nipplesPerBreast":1,"nippleLengthRatio":1,"nippleWidthRatio":1,"milkType":4,"milkMultiplier":0,"milkStorageMultiplier":1,"milkFullness":0,"milkRate":10,"balls":2,"ballTags":[],"ballEfficiency":1,"ballSizeRaw":30,"ballSizeMod":0,"ballFullness":100,"cocks":[{"type":6,"virgin":true,"tags":[4,38],"lengthRaw":24,"lengthMod":0,"thicknessRatioRaw":1,"thicknessRatioMod":0,"flaccidRatio":0.4,"knotRatio":1,"pierced":0,"color":"brown"}],"feracityRaw":1,"feracityMod":0,"vagina":null,"clitLength":0.5,"girlCumType":1,"cumType":2,"cumMultiplierRaw":4.5,"cumMultiplierMod":0,"ass":{"type":6,"hymen":false,"clits":0,"color":"pink","wetnessRaw":0,"wetnessMod":0,"loosenessRaw":1,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"reagents":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"defaultCockIdx":0,"lastRingSlotEquipped":2,"lastRechargeEquipped":1},
            "cait":{"name":"Cait","cName":"","soloCombatPrefix":"","taxa":1,"class":3,"background":10,"genderPref":1,"isPlural":false,"partyLeader":false,"level":1,"exp":0,"canGainExp":true,"compTags":[4],"actionPoints":1,"hitPoints":105,"hitPointsMaxMod":0,"resolvePoints":100,"resolveMaxMod":0,"threatMod":10,"strengthAlloc":0,"strengthMod":0,"toughnessAlloc":0,"toughnessMod":1,"agilityAlloc":0,"agilityMod":1,"cunningAlloc":0,"cunningMod":0,"willpowerAlloc":0,"willpowerMod":2,"presenceAlloc":0,"presenceMod":0,"libidoMod":15,"corruptionMod":0,"isLustImmune":false,"penetratingResist":0,"crushingResist":0,"holyResist":0,"blightResist":0,"acidResist":0,"fireResist":0,"frostResist":0,"stormResist":0,"teaseResist":0,"drugResist":0,"pheromoneResist":0,"fatigueResist":0,"mindResist":0,"raceAffinities":[2,3,5],"classAffinities":[4,1,5],"backgroundAffinities":[5,3,2],"perks":[{"key":"StartingAttributeBonuses","values":[0,0,1,0,1,1]},{"key":"HealersHands","values":[]}],"powers":[{"key":"NormalAttack"},{"key":"NormalAttack"},{"key":"SpiritVeil"},{"key":"Heal"},{"key":"WhiteFire"}],"equippedPowers":[{"key":"Heal"},{"key":"WhiteFire"},null,{"key":"SpiritVeil"},null],"stance":null,"multiTurnAttack":null,"combatEffects":[],"statusEffects":[],"likes":[-14,-16,-17,-9],"dislikes":[-4,-8],"boon":null,"credits":0,"weaponPrimary":{"key":"CaitsStaff","args":[1]},"weaponSecondary":null,"backupFist":{"_name":"fist","_short":"Fist","_description":"Ideal for taking care of arguments and needy holes alike.","isPlural":false,"stackLimit":1,"stack":1,"type":1,"tags":[2,6],"value":1,"evasion":0,"accuracy":10,"spellpower":0,"crit":0,"armorPen":0,"damage":{"attackType":1,"damage":[{"type":2,"amount":5}]}},"head":null,"neck":null,"shoulders":{"key":"PriestessCloak","args":[1]},"armorSet":{"key":"PassionPriestessGarb","args":[1]},"hands":{"key":"SilverBracelets","args":[1]},"waist":{"key":"PotionBelt","args":[1]},"feet":{"key":"CaitsKneeBoots","args":[1]},"ring1":null,"ring2":null,"topGarment":null,"bottomGarment":null,"inventory":[],"keyItems":[],"set":{"key":"PassionSet","args":[1]},"originalRace":"catfolk","femininity":85,"tallness":66,"tone":40,"thickness":30,"hipRatingRaw":12,"hipRatingMod":0,"buttRatingRaw":12,"buttRatingMod":0,"bellyRatingRaw":7,"bellyRatingMod":0,"lipMod":0,"hairColor":"pink","skinColor":"fair","furColor":"brown","scaleColor":"","lipColor":"peach","hairLength":2,"hairStyle":"","hairType":1,"horns":0,"hornType":-1,"hornLength":0,"wingType":-1,"wingCount":0,"skinType":6,"skinTags":[],"tailType":4,"numTails":1,"tailTags":[],"armType":1,"armTags":[],"legCount":2,"legType":1,"legTags":[],"tongueType":1,"tongueTags":[],"faceType":1,"faceTags":[],"earType":1,"earTags":[],"earLength":0,"eyeType":1,"eyeTags":[],"eyeColor":"blue","orgasms":0,"lastOrgasm":0,"exhibRaw":0,"isVirgin":false,"vaginalVirgin":false,"cockVirgin":true,"analVirgin":true,"pregnancySpeedRaw":1,"pregnancySpeedMod":0,"breastRows":[{"breasts":2,"type":7,"tags":[],"sizeRaw":6,"sizeMod":0,"lactationBonusMod":0,"fullnessRaw":0}],"nippleColor":"pink","nipplesPerBreast":1,"nippleLengthRatio":1,"nippleWidthRatio":1,"milkType":4,"milkMultiplier":0,"milkStorageMultiplier":1,"milkFullness":0,"milkRate":10,"balls":0,"ballTags":[],"ballEfficiency":1,"ballSizeRaw":3,"ballSizeMod":0,"ballFullness":100,"cocks":[],"feracityRaw":1,"feracityMod":0,"vagina":{"type":1,"hymen":false,"clits":1,"color":"pink","wetnessRaw":1,"wetnessMod":0,"loosenessRaw":1.5,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"clitLength":0.5,"girlCumType":1,"cumType":2,"cumMultiplierRaw":1,"cumMultiplierMod":0,"ass":{"type":1,"hymen":false,"clits":0,"color":"pink","wetnessRaw":0,"wetnessMod":0,"loosenessRaw":1,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"reagents":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"defaultCockIdx":0,"lastRingSlotEquipped":2,"lastRechargeEquipped":1},
            "kiyoko":{"name":"Kiyoko","cName":"","soloCombatPrefix":"","taxa":1,"class":4,"background":4,"genderPref":1,"isPlural":false,"partyLeader":false,"level":1,"exp":0,"canGainExp":true,"compTags":[4],"actionPoints":1,"hitPoints":105,"hitPointsMaxMod":0,"resolvePoints":100,"resolveMaxMod":0,"threatMod":10,"strengthAlloc":0,"strengthMod":0,"toughnessAlloc":0,"toughnessMod":1,"agilityAlloc":0,"agilityMod":1,"cunningAlloc":0,"cunningMod":1,"willpowerAlloc":0,"willpowerMod":1,"presenceAlloc":0,"presenceMod":0,"libidoMod":15,"corruptionMod":0,"isLustImmune":false,"penetratingResist":0,"crushingResist":0,"holyResist":0,"blightResist":0,"acidResist":0,"fireResist":0,"frostResist":0,"stormResist":0,"teaseResist":0,"drugResist":0,"pheromoneResist":0,"fatigueResist":0,"mindResist":0,"raceAffinities":[0,4,5],"classAffinities":[4,3,5],"backgroundAffinities":[4,3,2],"perks":[{"key":"StartingAttributeBonuses","values":[0,0,0,0,2,0]}],"powers":[{"key":"NormalAttack"}],"equippedPowers":[null,null,null,null,null],"stance":null,"multiTurnAttack":null,"combatEffects":[],"statusEffects":[],"likes":[-14,-16,-17,-9],"dislikes":[-4,-8],"boon":null,"credits":0,"weaponPrimary":{"key":"Fist","args":[1]},"weaponSecondary":null,"backupFist":{"_name":"fist","_short":"Fist","_description":"Ideal for taking care of arguments and needy holes alike.","isPlural":false,"stackLimit":1,"stack":1,"type":1,"tags":[2,6],"value":1,"evasion":0,"accuracy":10,"spellpower":0,"crit":0,"armorPen":0,"damage":{"attackType":1,"damage":[{"type":2,"amount":5}]}},"head":null,"neck":null,"shoulders":null,"armorSet":null,"hands":null,"waist":null,"feet":null,"ring1":null,"ring2":null,"topGarment":null,"bottomGarment":null,"inventory":[],"keyItems":[],"set":null,"originalRace":"kitsune","femininity":90,"tallness":66,"tone":25,"thickness":15,"hipRatingRaw":3,"hipRatingMod":0,"buttRatingRaw":3,"buttRatingMod":0,"bellyRatingRaw":1,"bellyRatingMod":0,"lipMod":0,"hairColor":"orange","skinColor":"pale","furColor":"brown","scaleColor":"","lipColor":"peach","hairLength":2,"hairStyle":"","hairType":1,"horns":0,"hornType":-1,"hornLength":0,"wingType":-1,"wingCount":0,"skinType":6,"skinTags":[],"tailType":-1,"tailTags":[],"armType":1,"armTags":[],"legCount":2,"legType":1,"legTags":[],"tongueType":1,"tongueTags":[],"faceType":1,"faceTags":[],"earType":1,"earTags":[],"earLength":0,"eyeType":1,"eyeTags":[],"eyeColor":"green","orgasms":0,"lastOrgasm":0,"exhibRaw":0,"isVirgin":false,"vaginalVirgin":false,"cockVirgin":true,"analVirgin":true,"pregnancySpeedRaw":1,"pregnancySpeedMod":0,"breastRows":[{"breasts":2,"type":7,"tags":[],"sizeRaw":1,"sizeMod":0,"lactationBonusMod":0,"fullnessRaw":0}],"nippleColor":"pink","nipplesPerBreast":1,"nippleLengthRatio":1,"nippleWidthRatio":1,"milkType":4,"milkMultiplier":0,"milkStorageMultiplier":1,"milkFullness":0,"milkRate":10,"balls":0,"ballTags":[],"ballEfficiency":1,"ballSizeRaw":3,"ballSizeMod":0,"ballFullness":100,"cocks":[],"feracityRaw":1,"feracityMod":0,"vagina":{"type":1,"hymen":false,"clits":1,"color":"pink","wetnessRaw":1,"wetnessMod":0,"loosenessRaw":1.5,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"clitLength":0.5,"girlCumType":1,"cumType":2,"cumMultiplierRaw":1,"cumMultiplierMod":0,"ass":{"type":1,"hymen":false,"clits":0,"color":"pink","wetnessRaw":0,"wetnessMod":0,"loosenessRaw":1,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"reagents":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"defaultCockIdx":0,"lastRingSlotEquipped":2,"lastRechargeEquipped":2},
            "etheryn":{"name":"Etheryn","cName":"","soloCombatPrefix":"","taxa":1,"class":2,"background":2,"genderPref":1,"isPlural":false,"partyLeader":false,"level":3,"exp":0,"canGainExp":true,"compTags":[3],"actionPoints":1,"hitPoints":170,"hitPointsMaxMod":0,"resolvePoints":100,"resolveMaxMod":0,"threatMod":10,"strengthAlloc":0,"strengthMod":1,"toughnessAlloc":0,"toughnessMod":2,"agilityAlloc":2,"agilityMod":0,"cunningAlloc":2,"cunningMod":0,"willpowerAlloc":2,"willpowerMod":0,"presenceAlloc":0,"presenceMod":0,"libidoMod":8,"corruptionMod":0,"isLustImmune":false,"penetratingResist":0,"crushingResist":0,"holyResist":0,"blightResist":0,"acidResist":0,"fireResist":0,"frostResist":0,"stormResist":0,"teaseResist":0,"drugResist":0,"pheromoneResist":0,"fatigueResist":0,"mindResist":0,"raceAffinities":[0,4,5],"classAffinities":[2,3,0],"backgroundAffinities":[5,2,4],"perks":[{"key":"StartingAttributeBonuses","values":[0,0,1,0,1,1]}],"powers":[{"key":"NormalAttack"}],"equippedPowers":[null,null,null,null,null],"stance":null,"multiTurnAttack":null,"combatEffects":[],"statusEffects":[],"likes":[-3,-16,-15,-6],"dislikes":[-14,-4],"boon":null,"credits":0,"weaponPrimary":{"key":"Fist","args":[1]},"weaponSecondary":null,"backupFist":{"_name":"fist","_short":"Fist","_description":"Ideal for taking care of arguments and needy holes alike.","isPlural":false,"stackLimit":1,"stack":1,"type":1,"tags":[2,6],"value":1,"evasion":0,"accuracy":10,"spellpower":0,"crit":0,"armorPen":0,"damage":{"attackType":1,"damage":[{"type":2,"amount":5}]}},"head":null,"neck":null,"shoulders":null,"armorSet":null,"hands":null,"waist":null,"feet":null,"ring1":null,"ring2":null,"topGarment":null,"bottomGarment":null,"inventory":[],"keyItems":[],"set":null,"originalRace":"pale elf","femininity":65,"tallness":67,"tone":10,"thickness":5,"hipRatingRaw":2,"hipRatingMod":0,"buttRatingRaw":3,"buttRatingMod":0,"bellyRatingRaw":1,"bellyRatingMod":0,"lipMod":0,"hairColor":"blonde","skinColor":"white","furColor":"brown","scaleColor":"","lipColor":"pink","hairLength":2,"hairStyle":"","hairType":1,"horns":0,"hornType":-1,"hornLength":0,"wingType":-1,"wingCount":0,"skinType":6,"skinTags":[11],"tailType":-1,"numTails":0,"tailTags":[],"armType":1,"armTags":[],"legCount":2,"legType":1,"legTags":[],"tongueType":1,"tongueTags":[],"faceType":1,"faceTags":[28],"earType":5,"earTags":[3],"earLength":4,"eyeType":1,"eyeTags":[],"eyeColor":"blue","orgasms":0,"lastOrgasm":0,"exhibRaw":0,"isVirgin":true,"vaginalVirgin":true,"cockVirgin":true,"analVirgin":true,"pregnancySpeedRaw":1,"pregnancySpeedMod":0,"breastRows":[{"breasts":2,"type":3,"tags":[],"sizeRaw":1,"sizeMod":0,"lactationBonusMod":0,"fullnessRaw":0}],"nippleColor":"pink","nipplesPerBreast":1,"nippleLengthRatio":1,"nippleWidthRatio":1,"milkType":4,"milkMultiplier":0,"milkStorageMultiplier":1,"milkFullness":0,"milkRate":10,"balls":2,"ballTags":[],"ballEfficiency":1,"ballSizeRaw":3,"ballSizeMod":0,"ballFullness":100,"cocks":[{"type":1,"virgin":true,"tags":[],"lengthRaw":4,"lengthMod":0,"thicknessRatioRaw":1,"thicknessRatioMod":0,"flaccidRatio":0.4,"knotRatio":1,"pierced":0,"color":"pale"}],"feracityRaw":1,"feracityMod":0,"vagina":null,"clitLength":0.5,"girlCumType":1,"cumType":2,"cumMultiplierRaw":1,"cumMultiplierMod":0,"ass":{"type":1,"hymen":false,"clits":0,"color":"pink","wetnessRaw":0,"wetnessMod":0,"loosenessRaw":1,"loosenessMod":0,"bonusCapacity":0,"stretchCounter":0,"tags":[]},"reagents":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"defaultCockIdx":0,"lastRingSlotEquipped":2,"lastRechargeEquipped":2}
        };

        var editorVersion = "17";
        var gameVersion = "0.1.0";

        var globals = {
            Taxon: { toSave: n => n + 1, fromSave: n => n - 1, list: ["Humanoid", "Beast", "Demon", "Plant", "Ethereal", "Undead", "Construct", "Fey"] },
            Class: { list: ["None", "Warrior", "Thief", "White Mage", "Black Mage", "Charmer"] },
            Background: { list: ["None", "Noble", "Minstrel", "Soldier", "Arcanist", "Barbarian", "Scholar", "Slumrat", "Acolyte", "Hunter", "Courtesan"] },
            // Slutty = 1
            Affinity: { list: ["Strength", "Toughness", "Agility", "Cunning", "Willpower", "Presence"] },
            TFType: { list: ["Raw", "Body", "Limbs", "Face", "Head", "Tail", "Cock", "Milk", "Balls", "Breasts", "Butt", "Pussy", "Cum", "Feracity"] },
            // None = -1
            BodyType: { toSave: n => n - 1, fromSave: n => n + 1, list: ["None", "Unspecified", "Human", "Orc", "Canine", "Feline", "Sylvan/Elf", "Equine", "Vulpine", "Snake", "Mothrine", "Goat", "Swine", "Shark", "Bee", "Draconic", "Kangaroo", "Anemone", "Avian", "Tentacle", "Demonic", "Frog", "Gooey", "Bovine", "Lupine", "Mouse", "Sheep", "Lapine", "Arachnid", "Succubus", "Dove"] },
            BodyTag: { list: ["Internal", "Knotted", "Gooey", "Tapered", "Flared", "Blunt", "Prehensile", "Stinger Based", "Stinger Tipped", "Nubby", "Amorphous", "Smooth", "Ribbed", "Foreskinned", "Double Headed", "Thick", "Sticky", "Fluffy", "Lubricated", "Long", "Hollow", "Squishy", "Angular", "Freckled", "Muzzled", "Beak", "Furred", "Tusked", "Refined", "Scaled", "Feathered", "Chitinous", "Aphrodisiac Laced", "Paws", "Digitigrade", "Plantigrade", "Heels", "Hooves", "Sheathed", "Pumped", "Slightly Pumped", "Spiked", "Magicock"] },
            // None = -1
            FluidType: { toSave: n => n - 1, fromSave: n => n + 1, list: ["None", "Unspecified", "Girlcum", "Cum", "Honey", "Milk", "Chocolate Milk", "Strawberry Milk"] },
            // None = -1
            SkinType: { toSave: n => n - 1, fromSave: n => n + 1, list: ["None", "Unspecified", "Latex", "Plant", "Bark", "Fur", "Feathers", "Skin", "Scales", "Chitin", "Goo"] },
            // None = -1
            NippleType: { toSave: n => n - 1, fromSave: n => n + 1, list: ["None", "Unspecified", "Fuckable", "Flat", "Inverted", "Lipples", "Tentacled", "Dick", "Normal"] },
            // None = -1
            HairType: { toSave: n => n - 1, fromSave: n => n + 1, list: ["None", "Unspecified", "Hair", "Plant", "Quills", "Feathers", "Goo", "Tentacles", "Transparent"] },
            Weapons: { list: ["CaitsStaff", "Fist", "ShortSword", "CurvedBlade", "Spear", "Pike", "Poleaxe", "Battleaxe", "Francisca", "Javelin", "Quarterstaff", "BladeStaff", "HuntingBow", "WarBow", "Sling", "Mace", "Mastbreaker", "BeastKiller"] },
            ArmorSet: { list: ["ComfortableClothes", "ScaleArmor", "MailCuirass", "Breastplate", "ApprenticeRobes", "LeatherJerkin", "LeatherCoat", "PassionPriestessGarb", "AronasWarhides", "LoinclothAndGuards", "MailBikini"] },
            ItemHead: { list: [] },
            ItemNeck: { list: ["WardAmulet", "AmuletOfTransference", "AmuletOfUnion",] },
            ItemShoulders: { list: ["FlameCape", "PriestessCloak"] },
            ItemHands: { list: ["Gauntlets", "ArmGuards", "SilverBracelets"] },
            ItemWaist: { list: ["PotionBelt"] },
            ItemFeet: { list: ["CaitsKneeBoots", "LeatherBoots", "IronGreaves"] },
            Rings: { list: ["WizardRing"] },
            TopGarb: { list: [] },
            BottomGarb: { list: ["PlainUnderwear"] },
            Shields: { list: ["HoplonShield", "TowerShield", "WickerShield"] },
            Totems: { list: ["LynxTotem"] },
            TFs: { list: ["Wolfsboon", "FoxBerry", "CatsTongueBerry", "RootOfMan"] },
            Misc: { list: ["CampSupplies", "EffigySeed"] },
            Consumable: { list: [] },
            Set: { list: ["PassionGarb", "LoinSet"] },
            Boon: { list: ["VelunsBlessing", "HoneyMead", "SpicedWine", "RyeBeer", "AppleCider", "MonasteryWine", "LoversDry"] },
            StatusEffect: { list: ["AnallyFilled", "OrallyFilled", "VaginallyFilled", "Armorer", "SharpenBlades", "PrayerOfWarding", "ArcaneAttunement", "FocusingPerformance", "WarPaint", "EyeOfTheStorm", "Enervation", "AphrodisiacCovered"] },
            CombatEffect: { list: ["Prone", "Bleeding", "Sundered", "Obscured", "Staggered", "Burning", "Terrified", "Poisoned", "Frigid", "Stunned", "EnArousedervation", "Disarmed", "Blinded", "Blessed", "SpiritVeil", "Resistance", "WeaponBuff", "FeatherDance", "WarlordsCry", "TaintedBulwark", "FirstStrike", "Restrained"] },
            Powers: {
                list: [
                    "AssTease", "CrotchTease", "ChestTease", "Allure", "FeatherDance", "ChainmailJiggle", "BreastPlate", "CumSpray",
                    "GuardedStance", "SpiritVeil", "BolsteringDance", "Flight", "Frenzy", "AuraOfDesire", "PipersSong", "VineRestaints", "HarpySong", "Pollination", "Heal", "GroupHeal", "WarlordsCry", "SmokeBomb", "PocketSand", "TaintedBulwark", "Blessing", "Grease", "SongOfStorms", "BlindingBeauty", "Warcry",
                    "ButtStomp", "AerialDrop", "Quake", "Rush", "Grapple",
                    "PussyTailTease", "HarpyButtTease", "EffigyBoobTease", "CharmSpell", "EarthFist", "TentacleSlap", "BellyDance", "DickWobble", "ImpDirtyTrick",
                    "LustfulImages", "BlightOrb", "WhiteFire", "WitheringBolt", "LightningSpike", "WarSong", "EntropicWinds", "ShadowMagic", "SunOfJassira", "FireBolt", "PollenSpray",
                    "SummonFlameSpirit", "SummonStoneElemental", "SummonEffigy",
                    "NormalAttack", "Rend", "FadingStrike", "DirtyTrick", "ThunderStrike", "BleedingCut", "AmazonStrike", "Cleave", "ShellCracker", "MarkForDeath", "PrimeTarget", "GiantsReach", "Execute", "LustyTentacles", "Envenom", "TrickShot", "Shatterstrike"]
            },
            Perks: {
                list: [
                    "TwistTheKnife", "SharpenBlades", "Veteran", "Armorer", "HealersHands", "PrayerOfWarding", "ArcaneStrike", "ArcaneAttunement", "Stylish", "FocusingPerformance", "Warpaint", "RendingStrike", "EyeOfTheStorm", "StartingAttributeBonuses", "Leftovers",
                    "WellHung", "Buxom", "Stretchy", "SizeMonarch", "Breeder", "Sterile", "Milky", "Libidinous", "Reserved", "MessyOrgasm"
                ]
            },
            WeaponPrimary: { list: [] },
            WeaponSecondary: { list: [] },
            Items: { list: ["FoxBerry", "Wolfsboon"] },
            EquipSlots: ["weaponPrimary", "weaponSecondary", "head", "neck", "shoulders", "armorSet", "topGarment", "bottomGarment", "waist", "hands", "feet", "ring1", "ring2"]

        };
        globals.WeaponPrimary.list = globals.Weapons.list;
        globals.WeaponSecondary.list = globals.Shields.list, globals.Totems.list;
        globals.Items.list = [].concat(
            globals.Weapons.list,
            globals.ArmorSet.list,
            globals.ItemHead.list,
            globals.ItemNeck.list,
            globals.ItemShoulders.list,
            globals.ItemHands.list,
            globals.ItemWaist.listt,
            globals.ItemFeet.list,
            globals.Rings.list,
            globals.TopGarb.list,
            globals.BottomGarb.list,
            globals.Shields.list,
            globals.Totems.list,
            globals.TFs.list,
            globals.Misc.list,
            globals.Set.list
        ).filter(v => v != null);

        /*
            all
                label - The display name of the variable
                desc - A description of the variable
                type - Variable type (boolean, number, string, array, object, multioption)
                options - List of names or numbers that the variable can be
                groupTag - The display group the variable is part of
            array
                properties - The properties of each array entry
                min - The minimum size of the array
                max - The maximum size of the array
            multioption
                customCallback - Callback function used to change the output
            object
                properties - The properties of the object
                canBeNull - Can the value be null
            string
            boolean
            number
        */

        var charMap = {
            // Info
            "name": { label: "Name", type: "string", groupTag: "Info" },
            "title": { label: "Title", type: "string", groupTag: "Info" },
            "taxa": { label: "Taxon", type: "number", options: globals.Taxon, groupTag: "Info" },
            "class": { label: "Class", type: "number", options: globals.Class, groupTag: "Info" },
            "background": { label: "Background", type: "number", options: globals.Background, groupTag: "Info" },
            "genderPref": { label: "Gender Pref", type: "number", groupTag: "Info" },
            "level": { label: "Level", type: "number", groupTag: "Info" },
            "exp": { label: "Exp", type: "number", groupTag: "Info" },
            "orgasms": { label: "Orgasms", type: "number", groupTag: "Info" },
            "lastOrgasm": { label: "Last Orgasm", type: "number", groupTag: "Info" },
            // Stats
            "hitPoints": { label: "HP", type: "number", groupTag: "Stats" },
            "hitPointsMaxMod": { label: "HP Max Mod", type: "number", groupTag: "Stats" },
            "resolvePoints": { label: "Resolve Points", type: "number", groupTag: "Stats" },
            "resolveMaxMod": { label: "Resolve Points Max Mod", type: "number", groupTag: "Stats" },
            "threatMod": { label: "Threat Mod", type: "number", groupTag: "Stats" },
            "strengthAlloc": { label: "Strength Level", type: "number", groupTag: "Stats" },
            "strengthMod": { label: "Strength Mod", type: "number", groupTag: "Stats" },
            "toughnessAlloc": { label: "Toughness Level", type: "number", groupTag: "Stats" },
            "toughnessMod": { label: "Toughness Mod", type: "number", groupTag: "Stats" },
            "agilityAlloc": { label: "Agility Level", type: "number", groupTag: "Stats" },
            "agilityMod": { label: "Agility Mod", type: "number", groupTag: "Stats" },
            "cunningAlloc": { label: "Cunning Level", type: "number", groupTag: "Stats" },
            "cunningMod": { label: "Cunning Mod", type: "number", groupTag: "Stats" },
            "willpowerAlloc": { label: "Willpower Level", type: "number", groupTag: "Stats" },
            "willpowerMod": { label: "Willpower Mod", type: "number", groupTag: "Stats" },
            "presenceAlloc": { label: "Presence Level", type: "number", groupTag: "Stats" },
            "presenceMod": { label: "Presence Mod", type: "number", groupTag: "Stats" },
            "libidoMod": { label: "Libido Mod", type: "number", groupTag: "Stats" },
            "corruptionMod": { label: "Corruption Mod", type: "number", groupTag: "Stats" },
            "exhibRaw": { label: "Exhibition Raw", type: "number", groupTag: "Stats" },
            "feracityRaw": { label: "Feracity Raw", type: "number", groupTag: "Stats" },
            "feracityMod": { label: "Feracity Mod", type: "number", groupTag: "Stats" },
            "penetratingResist": { label: "Penetrating", type: "number", groupTag: "Stats.Resistance" },
            "crushingResist": { label: "Crushing", type: "number", groupTag: "Stats.Resistance" },
            "holyResist": { label: "Holy", type: "number", groupTag: "Stats.Resistance" },
            "blightResist": { label: "Blight", type: "number", groupTag: "Stats.Resistance" },
            "acidResist": { label: "Acid", type: "number", groupTag: "Stats.Resistance" },
            "fireResist": { label: "Fire", type: "number", groupTag: "Stats.Resistance" },
            "frostResist": { label: "Frost", type: "number", groupTag: "Stats.Resistance" },
            "stormResist": { label: "Storm", type: "number", groupTag: "Stats.Resistance" },
            "teaseResist": { label: "Tease", type: "number", groupTag: "Stats.Resistance" },
            "drugResist": { label: "Drug", type: "number", groupTag: "Stats.Resistance" },
            "pheromoneResist": { label: "Pheromone", type: "number", groupTag: "Stats.Resistance" },
            "fatigueResist": { label: "Fatigue", type: "number", groupTag: "Stats.Resistance" },
            "mindResist": { label: "Mind", type: "number", groupTag: "Stats.Resistance" },
            "raceAffinities": { label: "Race", type: "multioption", options: globals.Affinity, groupTag: "Stats.Affinities" },
            "classAffinities": { label: "Class", type: "multioption", options: globals.Affinity, groupTag: "Stats.Affinities" },
            "backgroundAffinities": { label: "Background", type: "multioption", options: globals.Affinity, groupTag: "Stats.Affinities" },
            // Effects
            "perks": {
                label: "Perks",
                type: "array",
                groupTag: "Effects",
                properties: {
                    type: "object",
                    canBeNull: false,
                    properties: {
                        "key": { label: "Key", type: "string", options: globals.Perks },
                        "values": { label: "Values", type: "array", properties: { type: "number" }, min: 6 }
                    }
                }
            },
            "statusEffects": {
                label: "Status",
                type: "array",
                groupTag: "Effects",
                properties: {
                    type: "object",
                    canBeNull: false,
                    properties: {
                        "key": { label: "Key", type: "string", options: globals.StatusEffect },
                        "duration": { label: "Duration", type: "number" },
                        "values": { label: "Values", type: "array", properties: { type: "number" } }
                    }
                }
            },
            "combatEffects": {
                label: "Combat",
                type: "array",
                groupTag: "Effects",
                properties: {
                    type: "object",
                    canBeNull: false,
                    properties: {
                        "key": { label: "Key", type: "string", options: globals.CombatEffect },
                        "duration": { label: "Duration", type: "number" },
                        "values": { label: "Values", type: "array", properties: { type: "number" } }
                    }
                }
            },
            "boon": {
                label: "Boon",
                type: "object",
                groupTag: "Effects",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.Boon },
                    "duration": { label: "Duration", type: "number" },
                    "values": { label: "Values", type: "array", properties: { type: "number" } }
                }
            },
            "powers": {
                label: "Powers",
                type: "multioption",
                options: globals.Powers,
                groupTag: "Effects",
                customCallback: (obj, key) => {
                    return (evnt) => {
                        var fieldset = evnt.currentTarget;
                        var list = Array.from(fieldset.getElementsByTagName("input")).filter(el => el.checked).map(el => ({ "key": el.name }));
                        obj[key] = list;
                    }
                }
            },
            "equippedPowers": {
                label: "Equipped Powers",
                type: "multioption",
                options: globals.Powers,
                groupTag: "Effects",
                customCallback: (obj, key) => {
                    return (evnt) => {
                        var fieldset = evnt.currentTarget;
                        var list = Array.from(fieldset.getElementsByTagName("input")).filter(el => el.checked).map(el => ({ "key": el.name }));
                        if (list.length > 5 && evnt.target.type === "checkbox" && !evnt.target.parentElement.classList.contains("selected")) {
                            evnt.target.parentElement.classList.add("selected");
                            evnt.target.checked = false;
                        }
                        else {
                            obj[key] = list;
                        }
                        obj[key].length = 5;
                    }
                }
            },
            // Inventory
            "credits": { label: "Credits", type: "number", groupTag: "Inventory" },
            "weaponPrimary": {
                label: "Primary Weapon",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.WeaponPrimary }
                }
            },
            "weaponSecondary": {
                label: "Secondary Weapon",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.WeaponSecondary }
                }
            },
            "head": {
                label: "Head",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.ItemHead }
                }
            },
            "neck": {
                label: "Neck",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.ItemNeck }
                }
            },
            "shoulders": {
                label: "Shoulders",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.ItemShoulders }
                }
            },
            "armorSet": {
                label: "Armor Set",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.ArmorSet }
                }
            },
            "hands": {
                label: "Hands",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.ItemHands }
                }
            },
            "waist": {
                label: "Waist",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.ItemWaist }
                }
            },
            "feet": {
                label: "Feet",
                type: "object", 
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.ItemFeet }
                }
            },
            "ring1": {
                label: "Ring 1",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.Rings }
                }
            },
            "ring2": {
                label: "Ring 2",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.Rings }
                }
            },
            "topGarment": {
                label: "Top Garment",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.TopGarb }
                }
            },
            "bottomGarment": {
                label: "Bottom Garment",
                type: "object",
                groupTag: "Inventory.Equipment",
                canBeNull: true,
                properties: {
                    "key": { label: "Key", type: "string", options: globals.BottomGarb }
                }
            },
            "inventory": {
                label: "Items",
                type: "array",
                groupTag: "Inventory",
                properties: {
                    type: "object",
                    properties: {
                        "key": { label: "Key", type: "string", options: globals.Items }
                    }
                }
            },
            "reagents": {
                label: "Reagents",
                type: "object",
                groupTag: "Inventory",
                canBeNull: false,
                properties: (() => {
                    var obj = {};
                    for (var index = 0; index < globals.TFType.list.length; index++)
                        obj[index] = { label: globals.TFType.list[index], type: "number" };
                    return obj;
                })()
            },
            "keyItems": {
                label: "Key Items",
                type: "array",
                groupTag: "Inventory",
                properties: {
                    type: "object",
                    properties: {
                        "key": { label: "Key", type: "string" }
                    }
                }
            },
            // Body
            "originalRace": { label: "Original Race", type: "string", groupTag: "Body" },
            "femininity": { label: "Feminitity", type: "number", groupTag: "Body" },
            "tallness": { label: "Tallness", type: "number", groupTag: "Body" },
            "tone": { label: "Tone", type: "number", groupTag: "Body" },
            "thickness": { label: "Thickness", type: "number", groupTag: "Body" },
            "skinType": { label: "Type", type: "number", options: globals.SkinType, groupTag: "Body.Skin" },
            "skinTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Body.Skin" },
            "skinColor": { label: "Skin Color", type: "string", groupTag: "Body.Skin" },
            "furColor": { label: "Fur Color", type: "string", groupTag: "Body.Skin" },
            "scaleColor": { label: "Scale Color", type: "string", groupTag: "Body.Skin" },
            "isVirgin": { label: "Virgin", type: "boolean", groupTag: "Body.Virginity" },
            "vaginalVirgin": { label: "Vaginal", type: "boolean", groupTag: "Body.Virginity" },
            "cockVirgin": { label: "Cock", type: "boolean", groupTag: "Body.Virginity" },
            "analVirgin": { label: "Anal", type: "boolean", groupTag: "Body.Virginity" },
            "pregnancySpeedRaw": { label: "Speed Raw", type: "number", groupTag: "Body.Pregnancy" },
            "pregnancySpeedMod": { label: "Speed Mod", type: "number", groupTag: "Body.Pregnancy" },
            // Head
            "horns": { label: "Count", type: "number", groupTag: "Body.Head.Horns" },
            "hornType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Body.Head.Horns" },
            "hornLength": { label: "Length", type: "number", groupTag: "Body.Head.Horns" },
            "hairColor": { label: "Color", type: "string", groupTag: "Body.Head.Hair" },
            "hairLength": { label: "Length", type: "number", groupTag: "Body.Head.Hair" },
            "hairStyle": { label: "Style", type: "string", groupTag: "Body.Head.Hair" },
            "hairType": { label: "Type", type: "number", options: globals.HairType, groupTag: "Body.Head.Hair" },
            "earType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Body.Head.Ears" },
            "earTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Body.Head.Ears" },
            "earLength": { label: "Count", type: "number", groupTag: "Body.Head.Ears" },
            "faceType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Body.Head.Face" },
            "faceTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Body.Head.Face" },
            "eyeType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Body.Head.Eyes" },
            "eyeTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Body.Head.Eyes" },
            "eyeColor": { label: "Color", type: "string", groupTag: "Body.Head.Eyes" },
            "lipMod": { label: "Mod", type: "number", groupTag: "Body.Head.Lips" },
            "lipColor": { label: "Color", type: "string", groupTag: "Body.Head.Lips" },
            "tongueType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Body.Head.Tongue" },
            "tongueTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Body.Head.Tongue" },
            // Torso
            "wingType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Body.Wings" },
            "wingCount": { label: "Count", type: "number", groupTag: "Body.Wings" },
            "armType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Body.Arms" },
            "armTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Body.Arms" },
            "breastRows": {
                label: "Row",
                type: "array",
                groupTag: "Body.Breasts",
                min: 1,
                properties: {
                    type: "object",
                    canBeNull: false,
                    properties: {
                        "breasts": { label: "Count", type: "number" },
                        "type": { label: "Type", type: "number", options: globals.NippleType },
                        "tags": { label: "Tags", type: "multioption", options: globals.BodyTag },
                        "sizeRaw": { label: "Size Raw", type: "number" },
                        "sizeMod": { label: "Size Mod", type: "number" },
                        "lactationBonusMod": { label: "Lacation Bonus Mod", type: "number" },
                        "fullnessRaw": { label: "Fullness Raw", type: "number" },
                    }
                }
            },
            "nippleColor": { label: "Color", type: "string", groupTag: "Body.Breasts.Nipples" },
            "nipplesPerBreast": { label: "Per Breast", type: "number", groupTag: "Body.Breasts.Nipples" },
            "nippleLengthRatio": { label: "Length Ratio", type: "number", groupTag: "Body.Breasts.Nipples" },
            "nippleWidthRatio": { label: "Width Ratio", type: "number", groupTag: "Body.Breasts.Nipples" },
            "milkType": { label: "Type", type: "number", options: globals.FluidType, groupTag: "Body.Breasts.Milk" },
            "milkMultiplier": { label: "Multiplier", type: "number", groupTag: "Body.Breasts.Milk" },
            "milkStorageMultiplier": { label: "Storage Multiplier", type: "number", groupTag: "Body.Breasts.Milk" },
            "milkFullness": { label: "Fullness", type: "number", groupTag: "Body.Breasts.Milk" },
            "milkRate": { label: "Rate", type: "number", groupTag: "Body.Breasts.Milk" },
            "bellyRatingRaw": { label: "Rating Raw", type: "number", groupTag: "Body.Belly" },
            "bellyRatingMod": { label: "Rating Mod", type: "number", groupTag: "Body.Belly" },
            // Lower Torso
            "hipRatingRaw": { label: "Rating Raw", type: "number", groupTag: "Body.Hips" },
            "hipRatingMod": { label: "Rating Mod", type: "number", groupTag: "Body.Hips" },
            "tailType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Body.Tails" },
            "numTails": { label: "Count", type: "number", groupTag: "Body.Tails" },
            "tailTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Body.Tails" },
            "buttRatingRaw": { label: "Rating Raw", type: "number", groupTag: "Body.Butt" },
            "buttRatingMod": { label: "Rating Mod", type: "number", groupTag: "Body.Butt" },
            "ass": {
                label: "Butt",
                type: "object",
                groupTag: "Body.Butt",
                canBeNull: false,
                properties: {
                    "type": { label: "Type", type: "number", options: globals.BodyType },
                    "hymen": { label: "Hymen", type: "boolean" },
                    "clits": { label: "Clits", type: "number" },
                    "color": { label: "Color", type: "string" },
                    "wetnessRaw": { label: "Wetness Raw", type: "number" },
                    "wetnessMod": { label: "Wetness Mod", type: "number" },
                    "loosenessRaw": { label: "Looseness Raw", type: "number" },
                    "loosenessMod": { label: "Looseness Mod", type: "number" },
                    "bonusCapacity": { label: "Bonus Capacity", type: "number" },
                    "stretchCounter": { label: "Stretch Counter", type: "number" },
                    "tags": { label: "Tags", type: "multioption", options: globals.BodyTag }
                }
            },
            "legType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Body.Legs" },
            "legTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Body.Legs" },
            "legCount": { label: "Count", type: "number", groupTag: "Body.Legs" },
            // Genitals
            "girlCumType": { label: "Girl Cum Type", type: "number", options: globals.FluidType, groupTag: "Body.Genitals.Cum" },
            "cumType": { label: "Cum Type", type: "number", options: globals.FluidType, groupTag: "Body.Genitals.Cum" },
            "cumMultiplierRaw": { label: "Cum Multiplier Raw", type: "number", groupTag: "Body.Genitals.Cum" },
            "cumMultiplierMod": { label: "Cum Multiplier Mod", type: "number", groupTag: "Body.Genitals.Cum" },
            "cocks": {
                label: "Cocks",
                type: "array",
                groupTag: "Body.Genitals",
                properties: {
                    type: "object",
                    canBeNull: false,
                    properties: {
                        "type": { label: "Type", type: "number", options: globals.BodyType },
                        "virgin": { label: "Virgin", type: "boolean" },
                        "tags": { label: "Tags", type: "multioption", options: globals.BodyTag },
                        "lengthRaw": { label: "Length Raw", type: "number" },
                        "lengthMod": { label: "Length Mod", type: "number" },
                        "thicknessRatioRaw": { label: "Thickness Ratio Raw", type: "number" },
                        "thicknessRatioMod": { label: "Thickness Ratio Mod", type: "number" },
                        "flaccidRatio": { label: "Flaccid Ratio", type: "number" },
                        "knotRatio": { label: "Knot Ratio", type: "number" },
                        "pierced": { label: "Pierced", type: "number" },
                        "color": { label: "Color", type: "string" },
                    }
                }
            },
            "balls": { label: "Count", type: "number", groupTag: "Body.Genitals.Balls" },
            "ballTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Body.Genitals.Balls" },
            "ballEfficiency": { label: "Efficiency", type: "number", groupTag: "Body.Genitals.Balls" },
            "ballSizeRaw": { label: "Size Raw", type: "number", groupTag: "Body.Genitals.Balls" },
            "ballSizeMod": { label: "Size Mod", type: "number", groupTag: "Body.Genitals.Balls" },
            "ballFullness": { label: "Fullness", type: "number", groupTag: "Body.Genitals.Balls" },
            "clitLength": { label: "Length", type: "number", groupTag: "Body.Genitals.Clit" },
            "vagina": {
                label: "Vagina",
                type: "object",
                groupTag: "Body.Genitals",
                canBeNull: true,
                properties: {
                    "type": { label: "Type", type: "number", options: globals.BodyType },
                    "hymen": { label: "Hymen", type: "boolean" },
                    "clits": { label: "Clits", type: "number" },
                    "color": { label: "Color", type: "string" },
                    "wetnessRaw": { label: "Wetness Raw", type: "number" },
                    "wetnessMod": { label: "Wetness Mod", type: "number" },
                    "loosenessRaw": { label: "Looseness Raw", type: "number" },
                    "loosenessMod": { label: "Looseness Mod", type: "number" },
                    "bonusCapacity": { label: "Bonus Capacity", type: "number" },
                    "stretchCounter": { label: "Stretch Counter", type: "number" },
                    "tags": { label: "Tags", type: "multioption", options: globals.BodyTag }
                }
            },
        };

        //
        // Create Elements
        //

        function createTextInput(initialValue, className, changeFunc) {
            var textAreaEl = document.createElement("input");
            textAreaEl.type = "text";
            textAreaEl.className = className;
            textAreaEl.value = initialValue;
            if (changeFunc)
                textAreaEl.addEventListener("change", changeFunc);
            return textAreaEl;
        }

        function createCheckBox(checked, className, changeFunc) {
            var checkBoxEl = document.createElement("input");
            checkBoxEl.className = className;
            checkBoxEl.checked = checked;
            checkBoxEl.type = "checkbox";
            if (changeFunc)
                checkBoxEl.addEventListener("change", changeFunc);
            return checkBoxEl;
        }

        function createPanel() {
            var panel = document.createElement("div");
            panel.className = "panel";
            return panel;
        }

        function createAccordButton(text, panelEl, onClickFunc, clearOtherTabs = false) {
            var accordButton = document.createElement("button");
            accordButton.innerText = text;
            accordButton.className = "accordion";
            accordButton.addEventListener("click", function accordClick() {
                if (this.className && clearOtherTabs) {
                    var otherTabs = this.parentElement.getElementsByClassName(this.className);
                    for (var i = 0; i < otherTabs.length; i++) {
                        otherTabs[i].className = otherTabs[i].className.replace(" active", "");
                    }
                }
                this.classList.toggle("active");
                if (panelEl) {
                    var panel = panelEl;
                    panel.style.display = panel.style.display === "none" || panel.style.display === "" ? "block" : "none";
                }
                if (onClickFunc)
                    onClickFunc(panel);
            });
            return accordButton;
        }

        //
        // On Click Top Tab Functions
        //

        function clearElement(el) {
            while (el.lastElementChild) {
                el.removeChild(el.lastElementChild);
            }
        }

        function generateCharList(obj, el) {
            var container = document.createElement("div");
            el.appendChild(container);
            container.className = "charContainer";
            var charList = document.createElement("div");
            container.appendChild(charList);
            charList.className = "charList";
            var charDesc = document.createElement("div");
            container.appendChild(charDesc);
            charDesc.className = "charDesc";
            Object.keys(obj.chars).filter(key => charDefaults[key]).forEach(function charKeys(key) {
                var charListEntry = createAccordButton(key, charDesc, function onClickCharDesc(panel) {
                    clearElement(panel);
                    var charKey = key;
                    if (!window.editObj)
                        alert("No Save loaded");
                    else if (!window.editObj.chars)
                        alert("No Characters in save");
                    else if (!window.editObj.chars[charKey])
                        alert("Character " + charKey + " not found");
                    else {
                        panel.style.display = "block";
                        var topTagButtons = document.createElement("div");
                        charDesc.appendChild(topTagButtons);
                        topTagButtons.className = "topTagButtons";
                        var topTagPanels = document.createElement("div");
                        charDesc.appendChild(topTagPanels);
                        topTagPanels.className = "topTagPanels";
                        var tags = {};
                        var starterTags = ["Info", "Stats", "Effects", "Inventory", "Body"];
                        var panel;
                        var button;
                        for (var index = 0; index < starterTags.length; index++) {
                            panel = createTopTagPanel(topTagPanels);
                            button = createTopTagButton(starterTags[index], panel, topTagButtons);
                            tags[starterTags[index]] = { panel: panel, button: button };
                        }
                        generateMappedFields(tags, Object.keys(charMap).reverse().map((key) => generateInfo(window.editObj.chars[charKey], key, panel, charMap)));
                    }
                }, true);
                charListEntry.className += " charListEntry";
                charList.appendChild(charListEntry);
            });
        }

        function createTopTagPanel(parent) {
            var panel = createPanel();
            panel.className += " topTagPanel";
            parent.appendChild(panel);
            return panel;
        }

        function createTopTagButton(label, panel, parent) {
            var button = createAccordButton(label, panel, function topTagClick() {
                var otherPanels = panel.parentElement.getElementsByClassName(panel.className);
                var otherPanel;
                for (var i = 0; i < otherPanels.length; i++) {
                    otherPanel = otherPanels[i];
                    otherPanel.style.display = "none";
                }
                panel.style.display = "block";
            }, true);
            button.className += " topTagButton";
            parent.appendChild(button);
            return button;
        }

        function onClickCharTab(panel) {
            clearElement(panel);
            panel.style.display = "block";
            if (!window.editObj)
                alert("No Save File loaded");
            else
                generateCharList(window.editObj, panel);
        }

        function onClickFlagTab(panel) {
            clearElement(panel);
            panel.style.display = "block";
            if (!window.editObj)
                alert("No Save File loaded");
            else if (!window.editObj.flags)
                alert("No Flags in save file");
            else
                generateFields(window.editObj.flags, panel);
        }

        function onClickRawTab(panel) {
            clearElement(panel);
            panel.style.display = "block";
            if (!window.editObj)
                alert("No Save File loaded");
            else
                generateFields(window.editObj, panel);
        }

        function onClickLoadTab(panel) {
            panel.click();
        }

        function onClickSaveTab(panel) {
            if (fileReader) {
                var blob = new Blob([JSON.stringify(saveObj())], { type: 'text/json' });
                if (!!window.StyleMedia) // IE Edge
                    window.navigator.msSaveBlob(blob, file.name);
                else
                    panel.href = window.URL.createObjectURL(blob);
                panel.download = file.name;
                panel.click();
            }
            else {
                alert("No Save File loaded");
            }
        }

        //
        // File Reading and Object Loading/Saving
        //

        var file;
        var fileReader;
        function handleFiles(event) {
            if (!event.target.files || event.target.files.length === 0) {
                alert("Error in file loading");
            }
            file = event.target.files[0];
            fileReader = new FileReader();
            fileReader.readAsText(file);
            fileReader.addEventListener("loadend", function () {
                var obj;
                try {
                    obj = JSON.parse(fileReader.result);
                }
                catch (e) {
                    console.error(e);
                    alert("Error parsing file");
                }
                if (obj) {
                    loadObj(obj);
                    alert("Load Complete");
                }
            });
            fileReader.addEventListener("error", function (evnt) {
                console.log(evnt);
                alert("Error reading file");
            });
        }

        function unpackSave(obj) {
            Object.keys(obj.chars).forEach(charKey => {
                if (charDefaults[charKey]) {
                    obj.chars[charKey] = Object.assign(JSON.parse(JSON.stringify(charDefaults[charKey])), obj.chars[charKey]);
                }
            });
        }

        function loadObj(obj) {
            window.fileObj = obj;
            window.editObj = JSON.parse(JSON.stringify(obj));
            unpackSave(window.editObj);
            window.dupObj = JSON.parse(JSON.stringify(window.editObj));

            // autoload pc char desc
            var tabs = Array.from(document.getElementsByClassName("tab"));
            if (tabs.length > 0) {
                tabs.filter(el => el.textContent === "Characters")[0].click();
                var chars = Array.from(document.getElementsByClassName("charListEntry"));
                if (chars.length > 0) {
                    chars.filter(el => el.textContent === "pc")[0].click();
                    var topTabs = Array.from(document.getElementsByClassName("topTagButton"));
                    if (topTabs.length > 0)
                        topTabs.filter(el => el.textContent === "Info")[0].click();
                }
            }
        }

        function isObj(obj) {
            return typeof obj === "object" && obj !== null;
        }

        var noValue = { noValue: true };
        function diffObjects(orig, edit) {
            var diffObj = {};
            var queue = [{ orig: orig, edit: edit, depth: [] }];
            var info;
            while (queue.length > 0) {
                info = queue.pop();
                // console.log(JSON.stringify(info));
                if (isObj(info.orig) && isObj(info.edit)) {
                    Object.keys(info.orig).forEach(k => {
                        queue.push({ orig: info.orig[k], edit: info.edit[k], depth: [{ key: k, array: Array.isArray(info.orig[k]) }].concat(info.depth) })
                    });
                    Object.keys(info.edit).forEach(k => {
                        queue.push({ orig: info.orig[k], edit: info.edit[k], depth: [{ key: k, array: Array.isArray(info.edit[k]) }].concat(info.depth) })
                    });
                }
                else if (info.orig !== info.edit) {
                    var depthQueue = info.depth.slice();
                    var depthObj = diffObj;
                    var depthInfo;
                    while (depthQueue.length > 1) {
                        depthInfo = depthQueue.pop();
                        if (!depthObj[depthInfo.key]) {
                            if (depthInfo.array) {
                                depthObj[depthInfo.key] = [];
                            }
                            else depthObj[depthInfo.key] = {};
                        }
                        depthObj = depthObj[depthInfo.key];
                    }
                    depthInfo = depthQueue.pop();
                    depthObj[depthInfo.key] = info.edit === undefined ? noValue : info.edit;
                }
            }
            return diffObj;
        }

        function applyDiff(diff, dest) {
            var queue = [{ diff: diff, dest: dest, key: null, pdiff: null, pdest: null }];
            var info;
            while (queue.length > 0) {
                info = queue.pop();
                // console.log(JSON.stringify(info));
                if (info.diff === noValue) {
                    if (Array.isArray(info.pdest) && Array.isArray(info.pdiff))
                        info.pdest.splice(info.key, 1);
                    delete info.pdest[info.key];
                }
                else if (isObj(info.diff) && info.dest !== undefined) {
                    Object.keys(info.diff).forEach(k => {
                        queue.push({ diff: info.diff[k], dest: info.dest[k], key: k, pdiff: info.diff, pdest: info.dest })
                    });
                }
                else if (info.diff !== info.dest) {
                    info.pdest[info.key] = info.diff;
                }
            }
            return dest;
        }
        window.diff = () => diffObjects(window.dupObj, window.editObj);
        window.apply = () => applyDiff(window.diff(), JSON.parse(JSON.stringify(window.fileObj)));

        function saveObj() {
            return applyDiff(diffObjects(window.dupObj, window.editObj), JSON.parse(JSON.stringify(window.fileObj)));
        }

        //
        // Page creation
        //

        document.addEventListener("DOMContentLoaded", () => {
            var disclaimer = document.createElement("div");
            disclaimer.className = "disclaimer";
            disclaimer.innerHTML = "<h2>CoC2 Save Editor v" + editorVersion + "</h2><h4>For use with versions of CoC2 " + gameVersion + "+</h4><p>Disclaimer: Editing any saves may permanently mess up the save or cause unusual bugs or errors in the game. Edit at your own risk and remember to back up your saves.</p><p>Saves edited with v16 or earlier will not work.</p>";
            document.body.appendChild(disclaimer);

            var ok = document.createElement("button");
            ok.innerText = "Accept";
            ok.className = "accordion";
            disclaimer.appendChild(ok);

            ok.addEventListener("click", () => {
                while (document.body.lastChild) {
                    document.body.removeChild(document.body.lastChild);
                }

                var tabs = document.createElement("div");
                tabs.className = "tabs";
                document.body.appendChild(tabs);

                var content = document.createElement("div");
                content.className = "mainTabContent tabcontent";
                content.id = "mainContent";
                document.body.appendChild(content);

                var charTab = createAccordButton("Characters", content, onClickCharTab, true);
                charTab.className += " tab";
                tabs.appendChild(charTab);

                var flagTab = createAccordButton("Flags", content, onClickFlagTab, true);
                flagTab.className += " tab";
                tabs.appendChild(flagTab);

                var rawTab = createAccordButton("Raw", content, onClickRawTab, true);
                rawTab.className += " tab";
                tabs.appendChild(rawTab);

                var input = document.createElement("input");
                input.id = "load";
                input.type = "file";
                input.style.display = "none";
                input.addEventListener("change", handleFiles);
                var loadTab = createAccordButton("Load", input, onClickLoadTab, true);
                loadTab.className += " tab";
                loadTab.appendChild(input);
                tabs.appendChild(loadTab);

                var saveLink = document.createElement("a");
                saveLink.id = "saveLink";
                var saveTab = createAccordButton("Save", saveLink, onClickSaveTab, true);
                saveTab.className += " tab";
                saveTab.appendChild(saveLink);
                tabs.appendChild(saveTab);
            });
        });

        //
        // Set Callbacks
        //

        function setNumberCallback(obj, key, modFunc) {
            return (evnt) => { obj[key] = modFunc ? modFunc(evnt.target.value) : +evnt.target.value; }
        }

        function setStringCallback(obj, key) {
            return (evnt) => { obj[key] = evnt.target.value; }
        }

        function setSelectorStringCallback(obj, key) {
            return (evnt) => { obj[key] = evnt.target[+evnt.target.value].innerText === "None" ? null : evnt.target[+evnt.target.value].innerText; }
        }

        function setBooleanCallback(obj, key) {
            return (evnt) => obj[key] = evnt.target.checked;
        }

        function setMultiOptionCallback(obj, key, canSelectFunc) {
            return (evnt) => {
                if (evnt.currentTarget && evnt.currentTarget.type === "fieldset") {
                    var fieldset = evnt.currentTarget;
                    var list = Array.from(fieldset.getElementsByTagName("input")).filter(el => el.checked);
                    obj[key] = list.map(el => +el.value);
                }
            };
        }

        //
        // Fields
        //

        function fieldTitle(key) {
            var title = document.createElement("div");
            title.className = "fieldTitle";
            title.textContent = key;
            return title;
        }

        function fieldLabelNoInteract(key) {
            var entry = document.createElement("div");
            entry.className = "accordion fieldEntry";
            var title = fieldTitle(key);
            entry.appendChild(title);
            return entry;
        }

        function fieldLabel(key) {
            var entry = document.createElement("label");
            entry.className = "accordion fieldEntry";
            var title = fieldTitle(key);
            entry.appendChild(title);
            return entry;
        }

        function objectField(text, panel) {
            var accordButton = createAccordButton("", panel);
            var closed = " ", open = " ";
            accordButton.className += " fieldTitle";
            accordButton.innerText = closed + text;
            accordButton.addEventListener("click", function nameChanger() {
                this.innerText = this.innerText.startsWith(closed) ? this.innerText.replace(closed, open) : this.innerText.replace(open, closed);
            });
            return accordButton;
        }

        function stringField(name, initialValue, changeFunc) {
            var div = fieldLabel(name);
            var input = createTextInput(initialValue, "", changeFunc);
            div.appendChild(input);
            return div;
        }

        function booleanField(name, initialValue, changeFunc) {
            var div = fieldLabel(name);
            var input = createCheckBox(initialValue, "", changeFunc);
            div.appendChild(input);
            return div;
        }

        function selectField(name, initialValue, options, changeFunc) {
            var div = fieldLabel(name);
            var selector = document.createElement("select");
            options.list.forEach((value, index) => {
                var option = document.createElement("option");
                option.value = index;
                option.innerText = value;
                option.selected = (options.fromSave ? options.fromSave(initialValue) : initialValue) === index || initialValue === value;
                selector.appendChild(option);
            });
            selector.addEventListener("change", changeFunc);
            div.appendChild(selector);
            return div;
        }

        function multiOptionField(name, obj, key, mapValue, changeFunc) {
            var div = fieldLabelNoInteract(name);
            var fieldSetEl = document.createElement("fieldset");
            var options = mapValue.options
            fieldSetEl.addEventListener("click", mapValue.customCallback ? mapValue.customCallback(obj, key) : setMultiOptionCallback(obj, key));
            options.list.forEach((option, index) => {
                var selected = obj[key].reduce((prev, curr) => prev = prev || (option === curr) || (index === curr), false);
                var label = fieldLabel(option);
                label.className += " multioption" + (selected ? " selected" : "");
                var checkbox = createCheckBox(selected, "superhide", function callback() {
                    this.parentElement.classList.toggle("selected");
                });
                checkbox.value = options.list.indexOf(option);
                checkbox.name = option;
                label.appendChild(checkbox);
                fieldSetEl.appendChild(label);
            });
            fieldSetEl.addEventListener("change", changeFunc);
            div.appendChild(fieldSetEl);
            return div;
        }

        function generateAddRemoveButtons(panel, addCallback, removeCallback) {
            var addRemoveButtons = document.createElement("div");
            addRemoveButtons.className = "addRemoveButtons";
            var add = document.createElement("div");
            add.innerText = "+";
            add.className = "addRemoveButton accordion";
            add.addEventListener("click", addCallback);
            var remove = document.createElement("div");
            remove.innerText = "";
            remove.className = "addRemoveButton accordion";
            remove.addEventListener("click", removeCallback);
            addRemoveButtons.appendChild(add);
            addRemoveButtons.appendChild(remove);
            panel.appendChild(addRemoveButtons);
        }

        function generateInfo(obj, key, element, map) {
            return {
                obj: obj,
                key: key,
                element: element,
                map: map,
            }
        }

        function generateValue(map, value, canBeNull) {
            if (map.type === "object") {
                if (typeof value !== "object" || value == null) value = {};
                return Object.keys(map.properties).reduce((obj, key) => {
                    obj[key] = generateValue(map.properties[key], value[key]);
                    return obj;
                }, {});
            }
            if (map.type === "multioption" || map.type === "array") {
                if (!Array.isArray(value)) value = [];
                return value.map(entry => generateValue(map.properties, entry));
            }
            if (map.type === "number") return typeof value === "number" ? value : 0;
            if (map.type === "string") return typeof value === "string" ? value : "";
            if (map.type === "boolean") return !!value;
        }

        function processInfo(tags, info) {
            var obj = info.obj;
            var key = info.key;
            var mapEntry = info.map[key];
            var parentElement = info.element;
            var label = key;

            if (!mapEntry) {
                mapEntry = info.map;
            }

            if (mapEntry.label) {
                label = mapEntry.label;
            }

            if (!obj[key] && !mapEntry.canBeNull) {
                obj[key] = generateValue(mapEntry, obj[key]);
            }

            // tag = { panel, button }
            if (mapEntry.groupTag) {
                mapEntry.groupTag.split(".").reduce(function (parentTag, curTag) {
                    if (!parentTag[curTag]) parentTag[curTag] = { panel: null, button: null };
                    if (!parentTag[curTag].panel) {
                        var panel = createPanel();
                        var button = objectField(curTag, panel);
                        parentElement.appendChild(button);
                        parentElement.appendChild(panel);
                        parentTag[curTag].button = button;
                        parentTag[curTag].panel = panel;
                    }
                    parentElement = parentTag[curTag].panel;
                    return parentTag[curTag].panel;
                }, tags);
            }

            if (mapEntry.type === "multioption" && mapEntry.options) {
                parentElement.appendChild(multiOptionField(label, obj, key, mapEntry));
            }
            else if (mapEntry.type === "object" || mapEntry.type === "array") {
                var panel = createPanel();
                if (mapEntry.type === "object" && mapEntry.canBeNull) {
                    generateAddRemoveButtons(
                        panel,
                        objectAddCallback(tags, panel, obj, key, mapEntry),
                        objectRemoveCallback(panel, obj, key, mapEntry)
                    );
                }

                if (mapEntry.type === "array") {
                    if (mapEntry.min)
                        while (obj[key].length < mapEntry.min) {
                            obj[key].push(generateValue(mapEntry.properties, obj[key]));
                        }

                    if (!(mapEntry.min && mapEntry.max && mapEntry.min === mapEntry.max)) {
                        generateAddRemoveButtons(
                            panel,
                            arrayAddCallback(tags, panel, obj, key, mapEntry),
                            arrayRemoveCallback(panel, obj, key, mapEntry)
                        );
                    }
                }
                parentElement.appendChild(objectField(label, panel, obj[key], mapEntry));
                parentElement.appendChild(panel);

                if (obj[key])
                    return Object.keys(obj[key]).reverse().map((objKey) => generateInfo(obj[key], objKey, panel, mapEntry.properties));
            }
            else if (mapEntry.type === "string") {
                if (mapEntry.options)
                    parentElement.appendChild(selectField(label, generateValue(mapEntry, obj[key]), mapEntry.options, setSelectorStringCallback(obj, key)));
                else
                    parentElement.appendChild(stringField(label, generateValue(mapEntry, obj[key]), setStringCallback(obj, key)));
            }
            else if (mapEntry.type === "number") {
                if (mapEntry.options)
                    parentElement.appendChild(selectField(label, generateValue(mapEntry, obj[key]), mapEntry.options, setNumberCallback(obj, key, mapEntry.options.toSave)));
                else
                    parentElement.appendChild(stringField(label, generateValue(mapEntry, obj[key]), setNumberCallback(obj, key)));
            }
            else if (mapEntry.type === "boolean") {
                parentElement.appendChild(booleanField(label, generateValue(mapEntry, obj[key]), setBooleanCallback(obj, key)));
            }
        }

        function objectAddCallback(tags, parent, obj, key, map) {
            return () => {
                if (obj[key] == null) {
                    obj[key] = generateValue(map, obj[key]);
                    generateMappedFields(tags, Object.keys(map.properties).reverse().map((mapKey) =>
                        generateInfo(obj[key], mapKey, parent, map.properties)
                    ));
                }
            };
        }
        function objectRemoveCallback(parent, obj, key) {
            return () => {
                if (obj[key]) {
                    while (parent.lastChild && parent.lastChild !== parent.firstChild) {
                        parent.removeChild(parent.lastChild);
                    }
                    obj[key] = null;
                }
            };
        }

        function arrayAddCallback(tags, parent, obj, key, map) {
            return () => {
                if (!map.max || (map.max && obj[key].length < map.max)) {
                    if (typeof obj[key] === 'object')
                        generateMappedFields(tags, processInfo(tags, generateInfo(obj[key], Object.keys(obj[key]).length + '', parent, map.properties)));
                    else
                        generateMappedFields(tags, processInfo(tags, generateInfo(obj[key], obj[key].length, parent, map.properties)));
                }
            };
        }

        function arrayRemoveCallback(parent, obj, key, map) {
            return () => {
                if (obj[key]) {
                    if (obj[key].length > (map.min ? map.min : 0) && parent.lastChild) {
                        parent.removeChild(parent.lastChild);
                        if (typeof obj[key].pop() === "object")
                            parent.removeChild(parent.lastChild);
                    }
                }
            };
        }

        function generateMappedFields(tags, startInfo) {
            if (!startInfo)
                return;

            var queue = Array.isArray(startInfo) ? startInfo : [startInfo];
            var tags = tags ? tags : {};

            while (queue.length > 0) {
                var results = processInfo(tags, queue.pop());
                if (results)
                    queue = queue.concat(results);
            }
        }

        function generateFields(obj, element) {
            Object.keys(obj).forEach(function fieldKeys(key) {
                switch (typeof obj[key]) {
                    case "string": {
                        element.appendChild(stringField(key, obj[key], setStringCallback(obj, key)));
                        break;
                    }
                    case "number": {
                        element.appendChild(stringField(key, obj[key], setNumberCallback(obj, key)));
                        break;
                    }
                    case "boolean": {
                        element.appendChild(booleanField(key, obj[key], setBooleanCallback(obj, key)));
                        break;
                    }
                    case "object": {
                        if (obj[key] === null)
                            break;
                        var panel = createPanel();
                        element.appendChild(objectField(key, panel));
                        element.appendChild(panel);
                        generateFields(obj[key], panel);
                    }
                }
            });
        }
    </script>
</head>

<body>
</body>

</html>