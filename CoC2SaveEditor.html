<head>
    <style>
        body {
            background-color: #222;
            font-family: "Lato", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            color: #fff;
        }

        input {
            resize: none;
            background-color: #375a7f;
            color: #fff;
            border: 0px;
            font-family: inherit;
            padding-left: 2px;
        }

        select {
            background-color: #375a7f;
            color: #fff;
            border: 0px;
            width: 20%;
        }

        button {
            font-family: inherit;
            font-size: inherit;
        }

        .tabs {
            height: 8%;
        }

        .tab {
            width: 20% !important;
            text-align: center !important;
            height: 100%;
            font-size: 1.5em;
        }

        .tabcontent {
            display: none;
            background-color: #28415b;
            padding: 5px;
            transition: 0.4s;
            height: 90%;
            overflow-y: auto;
        }

        .accordion {
            background-color: #375a7f;
            color: #fff;
            cursor: pointer;
            padding: 5px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
        }

        .active,
        .accordion:hover {
            background-color: #28415b;
        }

        .panel {
            display: none;
            margin-left: 10px;
            padding: 2px 2px;
        }

        .charContainer {
            display: flex;
        }

        .charList {
            display: grid;
            height: 100%;
            width: 10%;
        }

        .charDesc {
            display: block;
            width: 90%;
            height: 100%;
            overflow-y: auto;
        }

        .fieldEntry {
            display: flex;
            width: auto !important;
        }

        .fieldTitle {
            width: 20%;
        }
    </style>
    <script>
        var globals = {
            Class: ["None", "Warrior", "Thief", "White Mage", "Black Mage"],
            Background: ["None", "Noble", "Minstrel", "Soldier", "Arcanist", "Barbarian", "Scholar", "Slumrat", "Acolyte", "Hunter", "Courtesan"],
            Affinity: ["Strength", "Toughness", "Agility", "Cunning", "Willpower", "Presence"],
            Power: ["None", "At Will", "Recharge", "Encounter", "Ultimate"],
            PowerTag: ["Weapon", "Melee", "Ranged", "Thrown", "Spell", "Stance", "Summon", "Healing", "Ally", "Omni", "Performance", "Tease"],
            Perk: ["None", "Class", "Story", "Sex"],
            Item: ["None", "Weapon", "Armor Set", "Head", "Neck", "Shoulders", "Hands", "Waist", "Feet", "Ring", "Top Garb", "Botttom Garb", "Shield"],
            ItemTag: ["Two Hand", "Heavy", "Light", "Bladed", "Thrown", "Ranged", "Melee", "Implement", "Catalyst", "Shield", "Skimpy", "Skin Tight", "Metal", "Leather", "Cloth", "Warded", "Calming", "Exp Chest", "Exp Crotch", "Exp Ass", "Conceal"],
            Damage: ["Raw", "Penetrating", "Crushing", "Holy", "Blight", "Acid", "Fire", "Frost", "Storm", "Tease", "Drug", "Pheromone", "Fatigue", "Mental"],
            Attack: ["None", "Physical", "Magical", "Mental", "Sexual"],
            // None = -1
            BodyType: ["None", "Unspecified", "Human", "Orc", "Canine", "Feline", "Sylvan", "Elf", "Equine", "Vulpine", "Snake", "Mothrine", "Goat", "Swine", "Shark", "Bee", "Draconic", "Kangaroo", "Anemone", "Avian", "Tentacle", "Demonic", "Frog", "Gooey", "Bovine", "Lupine", "Mouse", "Sheep", "Lapine", "Arachnid", "Succubus", "Dove"],
            BodyTag: ["Internal", "Knotted", "Gooey", "Tapered", "Flared", "Blunt", "Prehensile", "Stinger Based", "StingerTipped", "Nubby", "Amorphous", "Smooth", "Ribbed", "Foreskinned", "Double Headed", "Thick", "Sticky", "Fluffy", "Lubricated", "Long", "Hollow", "Squishy", "Angular", "Freckled", "Muzzled", "Beak", "Furred", "Tusked", "Refined", "Scaled", "Feathered", "Chitinous", "Aphrodisiac Laced", "Paws", "Digitigrade", "Plantigrade", "Heels", "Hooves", "Sheathed", "Pumped", "Slightly Pumped"],
            // None = -1
            FluidType: ["None", "Unspecified", "Girlcum", "Cum", "Honey", "Milk", "Chocolate Milk", "Strawberry Milk"],
            // None = -1
            SkinType: ["None", "Unspecified", "Latex", "Plant", "Bark", "Fur", "Feathers", "Skin", "Scales", "Chitin", "Goo"],
            // None = -1
            NippleType: ["None", "Unspecified", "Fuckable", "Flat", "Inverted", "Lipples", "Tentacled", "Dick", "Normal"],
            // None = -1
            HairType: ["None", "Unspecified", "Hair", "Plant", "Quills", "Feathers", "Goo", "Tentacles", "Transparent"],
            Weapons: ["None", "CaitsStaff", "Fist", "ShortSword", "CurvedBlade", "Spear", "Pike", "Poleaxe", "Battleaxe", "Francisca", "Javelin", "Quarterstaff", "BladeStaff", "HuntingBow", "WarBow", "Sling"],
            ArmorSet: ["None", "ComfortableClothes", "ScaleArmor", "MailCuirass", "Breastplate", "ApprenticeRobes", "LeatherJerkin", "LeatherCoat", "PassionPriestessGarb"],
            ItemHead: ["None",],
            ItemNeck: ["None", "WardAmulet"],
            ItemShoulders: ["None", "FlameCape", "PriestessCloak"],
            ItemHands: ["None", "Gauntlets", "ArmGuards", "SilverBracelets"],
            ItemWaist: ["None", "PotionBelt"],
            ItemFeet: ["None", "CaitsKneeBoots", "LeatherBoots", "IronGreaves"],
            Rings: ["None", "WizardRing"],
            TopGarb: ["None",],
            BottomGarb: ["None",],
            Shields: ["None", "HoplonShield", "TowerShield", "WickerShield"],
        };

        var charMap = {
            "name": { title: "Name", type: "string" },
            "class": { title: "Class", type: "number", options: globals.Class },
            "background": { title: "Background", type: "number", options: globals.Background },
            "level": { title: "Level", type: "number" },
            "exp": { title: "Exp", type: "number" },
            "hitPoints": { title: "HP", type: "number", tag: "Stats" },
            "hitPointsMaxMod": { title: "HP Max Modifier", type: "number", tag: "Stats" },
            "resolvePoints": { title: "Resolve Points", type: "number", tag: "Stats" },
            "resolveMaxMod": { title: "Resolve Points Max Modifier", type: "number", tag: "Stats" },
            "threatMod": { title: "Threat Modifier", type: "number", tag: "Stats" },
            "strengthAlloc": { title: "Strength", type: "number", tag: "Stats" },
            "strengthMod": { title: "Strength Modifier", type: "number", tag: "Stats" },
            "toughnessAlloc": { title: "Toughness", type: "number", tag: "Stats" },
            "toughnessMod": { title: "Toughness Modifier", type: "number", tag: "Stats" },
            "agilityAlloc": { title: "Agility", type: "number", tag: "Stats" },
            "agilityMod": { title: "Agility Modifier", type: "number", tag: "Stats" },
            "cunningAlloc": { title: "Cunning", type: "number", tag: "Stats" },
            "cunningMod": { title: "Cunning Modifier", type: "number", tag: "Stats" },
            "willpowerAlloc": { title: "Willpower", type: "number", tag: "Stats" },
            "willpowerMod": { title: "Willpower Modifier", type: "number", tag: "Stats" },
            "presenceAlloc": { title: "Presence", type: "number", tag: "Stats" },
            "presenceMod": { title: "Presence Modifier", type: "number", tag: "Stats" },
            "libidoMod": { title: "Libido Modifier", type: "number", tag: "Stats" },
            "corruptionMod": { title: "Corruption Modifier", type: "number", tag: "Stats" },
            "penetratingResist": { title: "Penetrating", type: "number", tag: "Resistance" },
            "crushingResist": { title: "Crushing", type: "number", tag: "Resistance" },
            "holyResist": { title: "Holy", type: "number", tag: "Resistance" },
            "blightResist": { title: "Blight", type: "number", tag: "Resistance" },
            "acidResist": { title: "Acid", type: "number", tag: "Resistance" },
            "fireResist": { title: "Fire", type: "number", tag: "Resistance" },
            "frostResist": { title: "Frost", type: "number", tag: "Resistance" },
            "stormResist": { title: "Storm", type: "number", tag: "Resistance" },
            "raceAffinities": { title: "Race", type: "number", options: globals.Affinity, tag: "Affinities" },
            "classAffinities": { title: "Class", type: "number", options: globals.Affinity, tag: "Affinities" },
            "backgroundAffinities": { title: "Background", type: "number", options: globals.Affinity, tag: "Affinities" },
            // "perks": [
            //     {
            //         "name": "Starting Attribute Bonuses",
            //         "desc": "Permanent bonuses based on starting race, class, and background",
            //         "tag": 2,
            //         "values": [
            //             0,
            //             0,
            //             0,
            //             0,
            //             0,
            //             3
            //         ]
            //     },
            //     {
            //         "name": "Breeder",
            //         "desc": "",
            //         "tag": 3,
            //         "values": []
            //     },
            //     {
            //         "name": "Stylish!",
            //         "desc": "Any piece of Light armor you wear automatically gains the Skimpy tag, if it didn't have it already. While you're wearing Light armor, you gain a bonus to Sexiness equal to your Charmer level.",
            //         "tag": 1,
            //         "values": []
            //     }
            // ],
            // "powers": [
            //     "NormalAttack",
            //     "BolsteringDance",
            //     "Allure",
            //     "WarSong"
            // ],
            // "equippedPowers": [
            //     "BolsteringDance",
            //     "Allure",
            //     null,
            //     "WarSong",
            //     null
            // ],
            // "stance": "",
            // "combatEffects": [],
            // "statusEffects": [],
            // "boon": null,
            "credits": { title: "Credits", type: "number" },
            "weaponPrimary": { title: "Primary Weapon", type: "string", options: globals.Weapons },
            "weaponSecondary": { title: "Secondary Weapon", type: "string", options: globals.Weapons },
            "head": { title: "Head", type: "string", options: globals.ItemHead },
            "neck": { title: "Neck", type: "string", options: globals.ItemNeck },
            "shoulders": { title: "Shoulders", type: "string", options: globals.ItemShoulders },
            "armorSet": { title: "Armor Set", type: "string", options: globals.ArmorSet },
            "hands": { title: "Hands", type: "string", options: globals.ItemHands },
            "waist": { title: "Waist", type: "string", options: globals.ItemWaist },
            "feet": { title: "Feet", type: "string", options: globals.ItemFeet },
            "rings": { title: "Rings", type: "string", options: globals.ItemHands },
            "topGarment": { title: "Top Garment", type: "string", options: globals.TopGarb },
            "bottomGarment": { title: "Bottom Garment", type: "string", options: globals.BottomGarb },
            // "inventory": [],
            // "keyItems": [],
            "originalRace": { title: "Original Race", type: "string" },
            "femininity": { title: "Feminitity", type: "number" },
            "tallness": { title: "Tallness", type: "number" },
            "tone": { title: "Tone", type: "number" },
            "thickness": { title: "Thickness", type: "number" },
            "hipRatingRaw": { title: "Hip Rating Raw", type: "number" },
            "hipRatingMod": { title: "Hip Rating Mod", type: "number" },
            "buttRatingRaw": { title: "Butt Rating Raw", type: "number" },
            "buttRatingMod": { title: "Butt Rating Mod", type: "number" },
            "bellyRatingRaw": { title: "Belly Rating Raw", type: "number" },
            "bellyRatingMod": { title: "Belly Rating Mod", type: "number" },
            "lipMod": { title: "Lip Mod", type: "number" },
            "hairColor": { title: "Hair Color", type: "string" },
            "skinColor": { title: "Skin Color", type: "string" },
            "furColor": { title: "Fur Color", type: "string" },
            "scaleColor": { title: "Scale Color", type: "string" },
            "lipColor": { title: "Lip Color", type: "string" },
            "hairLength": { title: "Hair Length", type: "number" },
            "hairStyle": { title: "Hair Style", type: "string" },
            "hairType": { title: "Hair Type", type: "number", options: globals.HairType },
            "horns": { title: "Horn Count", type: "number" },
            "hornType": { title: "Horn Type", type: "number", options: globals.BodyType },
            "hornLength": { title: "Horn Length", type: "number" },
            "wingType": { title: "Wing Type", type: "number", options: globals.BodyType },
            "wingCount": { title: "Wing Count", type: "number" },
            "skinType": { title: "Skin Type", type: "number", options: globals.SkinType },
            "skinTags": { title: "Skin Tags", type: "number", options: globals.BodyTag },
            "tailType": { title: "Tail Type", type: "number", options: globals.BodyType },
            "numTails": { title: "Tail Count", type: "number" },
            "tailTags": { title: "Tail Tags", type: "number", options: globals.BodyTag },
            "armType": { title: "Arm Type", type: "number", options: globals.BodyType },
            "armTags": { title: "Arm Tags", type: "number", options: globals.BodyTag },
            "legCount": { title: "Leg Count", type: "number" },
            "legType": { title: "Leg Type", type: "number", options: globals.BodyType },
            "legTags": { title: "Leg Tags", type: "number", options: globals.BodyTag },
            "tongueType": { title: "Tongue Type", type: "number", options: globals.BodyType },
            "tongueTags": { title: "Tongue Tags", type: "number", options: globals.BodyTag },
            "faceType": { title: "Face Type", type: "number", options: globals.BodyType },
            "faceTags": { title: "Face Tags", type: "number", options: globals.BodyTag },
            "earType": { title: "Ear Type", type: "number", options: globals.BodyType },
            "earTags": { title: "Ear Tags", type: "number", options: globals.BodyTag },
            "earLength": { title: "Ear Count", type: "number" },
            "eyeType": { title: "Eye Type", type: "number", options: globals.BodyType },
            "eyeTags": { title: "Eye Tags", type: "number", options: globals.BodyTag },
            "eyeColor": { title: "Eye Color", type: "string" },
            "exhibRaw": { title: "Exhibition Raw", type: "number" },
            "isVirgin": { title: "Virgin", type: "boolean" },
            "vaginalVirgin": { title: "Vaginal Virgin", type: "boolean" },
            "cockVirgin": { title: "Cock Virgin", type: "boolean" },
            "analVirgin": { title: "Anal Virgin", type: "boolean" },
            "pregnancySpeedRaw": { title: "Pregnancy Speed Raw", type: "number" },
            "pregnancySpeedMod": { title: "Pregnancy Speed Mod", type: "number" },
            // "breastRows": [
            //     {
            //         "breasts": 2,
            //         "type": 7,
            //         "tags": [],
            //         "sizeRaw": 5,
            //         "sizeMod": 0,
            //         "lactationBonusMod": 0,
            //         "fullnessRaw": 0
            //     }
            // ],
            // "nippleColor": "pink",
            // "nipplesPerBreast": 1,
            // "nippleLengthRatio": 1,
            // "nippleWidthRatio": 1,
            // "milkType": 4,
            // "milkMultiplier": 0,
            // "milkStorageMultiplier": 1,
            // "milkFullness": 0,
            // "milkRate": 10,
            // "balls": 0,
            // "ballTags": [],
            // "ballEfficiency": 3,
            // "ballSizeRaw": 2,
            // "ballSizeMod": 0,
            // "ballFullness": 50,
            // "cocks": [
            //     {
            //         "type": 3,
            //         "virgin": true,
            //         "tags": [
            //             1,
            //             3
            //         ],
            //         "lengthRaw": 8,
            //         "lengthMod": 0,
            //         "thicknessRatioRaw": 1,
            //         "thicknessRatioMod": 0,
            //         "flaccidRatio": 0.4,
            //         "knotRatio": 1.5,
            //         "pierced": 0,
            //         "color": "pink"
            //     }
            // ],
            // "feracityRaw": 2,
            // "feracityMod": 0,
            // "vagina": {
            //     "type": 1,
            //     "hymen": false,
            //     "clits": 1,
            //     "color": "pink",
            //     "wetnessRaw": 1,
            //     "wetnessMod": 0,
            //     "loosenessRaw": 1,
            //     "loosenessMod": 0,
            //     "bonusCapacity": 0,
            //     "stretchCounter": 0,
            //     "tags": []
            // },
            // "clitLength": 0.5,
            // "girlCumType": 1,
            // "cumType": 2,
            // "cumMultiplierRaw": 1,
            // "cumMultiplierMod": 0,
            // "ass": {
            //     "type": 1,
            //     "hymen": false,
            //     "clits": 0,
            //     "color": "pink",
            //     "wetnessRaw": 0,
            //     "wetnessMod": 0,
            //     "loosenessRaw": 1,
            //     "loosenessMod": 0,
            //     "bonusCapacity": 0,
            //     "stretchCounter": 0,
            //     "tags": []
            // },
            // "title": "Adventurer",
            // "wyldMark": -1,
            // "drinks": [],
            // "customImage": null,
            // "pendingLoot": []
        };

        //
        // Create Elements
        //

        function createTextInput(initialValue, className, changeFunc) {
            var textAreaEl = document.createElement("input");
            textAreaEl.type = "text";
            textAreaEl.className = className;
            textAreaEl.value = initialValue;
            textAreaEl.addEventListener("change", changeFunc);
            return textAreaEl;
        }

        function createCheckBox(initialValue, className, changeFunc) {
            var checkBoxEl = document.createElement("input");
            checkBoxEl.className = className;
            checkBoxEl.checked = initialValue === "true";
            checkBoxEl.type = "checkbox";
            checkBoxEl.addEventListener("change", changeFunc);
            return checkBoxEl;
        }

        function createPanel() {
            var panel = document.createElement("div");
            panel.className = "panel";
            return panel;
        }

        function createAccordButton(text, panelEl, onClickFunc, clearOtherTabs = false) {
            var accordButton = document.createElement("button");
            accordButton.innerText = text;
            accordButton.className = "accordion";
            accordButton.addEventListener("click", function accordClick() {
                if (this.className && clearOtherTabs) {
                    var otherTabs = this.parentElement.getElementsByClassName(this.className);
                    for (var i = 0; i < otherTabs.length; i++) {
                        otherTabs[i].className = otherTabs[i].className.replace(" active", "");
                    }
                }
                this.classList.toggle("active");
                if (panelEl) {
                    var panel = panelEl;
                    panel.style.display = panel.style.display === "none" || panel.style.display === "" ? "block" : "none";
                }
                if (onClickFunc)
                    onClickFunc(panel);
            });
            return accordButton;
        }

        //
        // On Click Top Tab Functions
        //

        function clearElement(el) {
            while (el.lastElementChild) {
                el.removeChild(el.lastElementChild);
            }
        }

        function generateCharList(obj, el) {
            var container = document.createElement("div");
            el.appendChild(container);
            container.className = "charContainer";
            var charList = document.createElement("div");
            container.appendChild(charList);
            charList.className = "charList";
            var charDesc = document.createElement("div");
            container.appendChild(charDesc);
            charDesc.className = "charDesc";
            Object.keys(obj.chars).forEach(function charKeys(key) {
                var charListEntry = createAccordButton(key, charDesc, function onClickCharDesc(panel) {
                    clearElement(panel);
                    var charKey = key;
                    if (!window.obj)
                        alert("No Save loaded");
                    else if (!window.obj.chars)
                        alert("No Characters in save");
                    else if (!window.obj.chars[charKey])
                        alert("Character " + charKey + " not found");
                    else {
                        panel.style.display = "block";
                        generateMappedFields(window.obj.chars[charKey], panel, charMap);
                    }
                }, true);
                charListEntry.className += " charListEntry";
                charList.appendChild(charListEntry);
            });
        }

        function onClickCharTab(panel) {
            clearElement(panel);
            panel.style.display = "block";
            if (!window.obj)
                alert("No Save File loaded");
            else
                generateCharList(window.obj, panel);
        }

        function onClickFlagTab(panel) {
            clearElement(panel);
            panel.style.display = "block";
            if (!window.obj)
                alert("No Save File loaded");
            else if (!window.obj.flags)
                alert("No Flags in save file");
            else
                generateFields(window.obj.flags, panel);
        }

        function onClickRawTab(panel) {
            clearElement(panel);
            panel.style.display = "block";
            if (!window.obj)
                alert("No Save File loaded");
            else
                generateFields(window.obj, panel);
        }

        function onClickLoadTab(panel) {
            panel.click();
        }

        function onClickSaveTab(panel) {
            if (fileReader) {
                panel.href = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(window.obj));
                panel.download = file.name;
                panel.click();
            }
            else {
                alert("No Save File loaded");
            }
        }

        //
        // File Reading and Object Loading
        //

        var file;
        var fileReader;
        function handleFiles(files) {
            file = files[0];
            fileReader = new FileReader();
            fileReader.readAsBinaryString(file);
            fileReader.addEventListener("loadend", () => {
                var obj = JSON.parse(fileReader.result);
                loadObj(obj);
            });
        }

        function loadObj(obj) {
            window.obj = obj;
        }

        //
        // Page creation
        //

        document.addEventListener("DOMContentLoaded", () => {
            var tabs = document.createElement("div");
            tabs.className = "tabs";
            document.body.appendChild(tabs);

            var content = document.createElement("div");
            content.className = "mainTabContent tabcontent";
            content.id = "mainContent";
            document.body.appendChild(content);

            var charTab = createAccordButton("", content, onClickCharTab, true);
            charTab.innerText = "Characters";
            charTab.className += " tab";
            tabs.appendChild(charTab);

            var flagTab = createAccordButton("", content, onClickFlagTab, true);
            flagTab.innerText = "Flags";
            flagTab.className += " tab";
            tabs.appendChild(flagTab);

            var rawTab = createAccordButton("", content, onClickRawTab, true);
            rawTab.innerText = "Raw";
            rawTab.className += " tab";
            tabs.appendChild(rawTab);

            var input = document.createElement("input");
            input.id = "load";
            input.type = "file";
            input.style.display = "none";
            input.addEventListener("change", handleFiles);
            var loadTab = createAccordButton("", input, onClickLoadTab, true);
            loadTab.innerText = "Load";
            loadTab.className += " tab";
            loadTab.appendChild(input);
            tabs.appendChild(loadTab);

            var saveLink = document.createElement("a");
            saveLink.id = "saveLink";
            var saveTab = createAccordButton("", saveLink, onClickSaveTab, true);
            saveTab.innerText = "Save";
            saveTab.className += " tab";
            saveTab.appendChild(saveLink);
            tabs.appendChild(saveTab);
        });

        //
        // Set Callbacks
        //

        function setNumberCallback(obj, key) {
            return (el) => { obj[key] = +el.srcElement.value; }
        }

        function setStringCallback(obj, key) {
            return (el) => { obj[key] = el.srcElement.value; }
        }

        function setSelectorStringCallback(obj, key) {
            return (el) => { obj[key] = el.srcElement[+el.srcElement.value].innerText; }
        }

        function setBooleanCallback(obj, key) {
            return (el) => obj[key] = el.srcElement.checked;
        }

        //
        // Fields
        //

        function fieldLabel(key) {
            var entry = document.createElement("div");
            entry.className = "accordion fieldEntry";
            var title = document.createElement("div");
            title.className = "fieldTitle";
            title.textContent = key;
            entry.appendChild(title);
            return entry;
        }

        function objectField(text, panel) {
            var accordButton = createAccordButton("", panel);
            var closed = "+ ", open = "- ";
            accordButton.innerText = closed + text;
            accordButton.addEventListener("click", function nameChanger() {
                this.innerText = this.innerText.startsWith(closed) ? this.innerText.replace(closed, open) : this.innerText.replace(open, closed);
            });
            return accordButton;
        }

        function stringField(name, initialValue, changeFunc) {
            var div = fieldLabel(name);
            var input = createTextInput(initialValue, "", changeFunc);
            div.appendChild(input);
            return div;
        }

        function booleanField(name, initialValue, changeFunc) {
            var div = fieldLabel(name);
            var input = createCheckBox(initialValue, "", changeFunc);
            div.appendChild(input);
            return div;
        }

        function selectField(name, initialValue, options, changeFunc, startsNegOne = false) {
            var div = fieldLabel(name);
            var selector = document.createElement("select");
            options.forEach((value, index) => {
                var option = document.createElement("option");
                option.value = index;
                option.innerText = value;
                if (initialValue + (startsNegOne ? 1 : 0) === index || initialValue === value)
                    option.selected = "selected";
                selector.appendChild(option);
            });
            selector.addEventListener("change", changeFunc);
            div.appendChild(selector);
            return div;
        }

        function generateMappedFields(obj, element, map) {
            var tags = {};
            if (map)
                Object.keys(obj).forEach(function mappedFieldKeys(key) {
                    if (map[key]) {
                        var parentElement = element;
                        if (map[key].tag) {
                            if (!tags[map[key].tag]) {
                                var panel = createPanel();
                                tags[map[key].tag] = panel;
                                const accordButton = objectField(map[key].tag, panel);
                                element.appendChild(accordButton);
                                element.appendChild(panel);
                            }
                            parentElement = tags[map[key].tag];
                        }
                        switch (map[key].type) {
                            case "string": {
                                if (map[key].options)
                                    parentElement.appendChild(selectField(map[key].title + ": ", obj[key], map[key].options, setSelectorStringCallback(obj, key)));
                                else
                                    parentElement.appendChild(stringField(map[key].title + ": ", obj[key], setStringCallback(obj, key)));
                                break;
                            }
                            case "number": {
                                if (map[key].options)
                                    parentElement.appendChild(selectField(map[key].title + ": ", obj[key], map[key].options, setNumberCallback(obj, key)));
                                else
                                    parentElement.appendChild(stringField(map[key].title + ": ", obj[key], setNumberCallback(obj, key)));
                                break;
                            }
                            case "boolean": {
                                parentElement.appendChild(booleanField(map[key].title + ": ", obj[key], setBooleanCallback(obj, key)));
                                break;
                            }
                            case "object": {
                                var panel = createPanel();
                                parentElement.appendChild(objectField(map[key].title + ": ", panel));
                                parentElement.appendChild(panel);
                                generateFields(obj[key], panel, map[key]);
                            }
                        }
                    }
                });
        }

        function generateFields(obj, element) {
            Object.keys(obj).forEach(function fieldKeys(key) {
                switch (typeof obj[key]) {
                    case "string": {
                        element.appendChild(stringField(key + ": ", obj[key], setStringCallback(obj, key)));
                        break;
                    }
                    case "number": {
                        element.appendChild(stringField(key + ": ", obj[key], setNumberCallback(obj, key)));
                        break;
                    }
                    case "boolean": {
                        element.appendChild(booleanField(key + ": ", obj[key], setBooleanCallback(obj, key)));
                        break;
                    }
                    case "array": {
                        element.appendChild(stringField(key + ": ", obj[key], setStringCallback(obj, key)));
                        break;
                    }
                    case "object": {
                        if (obj[key] === null)
                            break;
                        var panel = createPanel();
                        element.appendChild(objectField(key + ": ", panel));
                        element.appendChild(panel);
                        generateFields(obj[key], panel);
                    }
                }
            });
        }
    </script>
</head>

<body>
</body>