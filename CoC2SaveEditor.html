<head>
    <style>
        body {
            background-color: #222;
            font-family: "Lato", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            color: #fff;
        }

        input {
            resize: none;
            background-color: #375a7f;
            color: #fff;
            border: 0px;
            font-family: inherit;
            padding-left: 2px;
        }

        select {
            background-color: #375a7f;
            color: #fff;
            border: 0px;
            width: 20%;
        }

        button {
            font-family: inherit;
            font-size: inherit;
        }

        button.fieldTitle {
            width: 100%;
        }

        .multioption {
            display: inline-flex !important;
            position: relative;
        }

        .multioption.selected {
            background-color: #00bc8c;
        }

        .multioption .fieldTitle {
            width: auto;
        }

        .multioption input[type=checkbox] {
            opacity: 0;
            position: absolute;
            cursor: inherit;
        }

        .tabs {
            height: 8%;
        }

        .tab {
            width: 20% !important;
            text-align: center !important;
            height: 100%;
            font-size: 1.5em;
        }

        .tabcontent {
            display: none;
            background-color: #28415b;
            padding: 5px;
            transition: 0.4s;
            height: 90%;
            overflow-y: auto;
        }

        .accordion {
            background-color: #375a7f;
            color: #fff;
            cursor: pointer;
            padding: 5px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
        }

        .active,
        .accordion:hover {
            background-color: #28415b;
        }

        .panel {
            display: none;
            margin-left: 10px;
            padding: 2px 2px;
        }

        .charContainer {
            display: flex;
        }

        .charList {
            display: grid;
            height: 100%;
            width: 10%;
        }

        .charDesc {
            display: block;
            width: 90%;
            height: 100%;
            overflow-y: auto;
        }

        .fieldEntry {
            display: flex;
            width: auto !important;
        }

        .fieldEntry fieldset {
            margin: unset;
            border: unset;
            padding: unset;
            width: 80%;
        }

        .fieldTitle {
            width: 20%;
            font-family: "Lato", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            color: #fff;
            font-size: 1em;
        }

        .addRemoveButtons {
            display: flex;
        }

        .addRemoveButton {
            width: 1em;
            text-align: center;
        }
    </style>
    <script>
        var globals = {
            Class: ["None", "Warrior", "Thief", "White Mage", "Black Mage"],
            Background: ["None", "Noble", "Minstrel", "Soldier", "Arcanist", "Barbarian", "Scholar", "Slumrat", "Acolyte", "Hunter", "Courtesan"],
            Affinity: ["Strength", "Toughness", "Agility", "Cunning", "Willpower", "Presence"],
            Power: ["None", "At Will", "Recharge", "Encounter", "Ultimate"],
            PowerTag: ["Weapon", "Melee", "Ranged", "Thrown", "Spell", "Stance", "Summon", "Healing", "Ally", "Omni", "Performance", "Tease"],
            Perk: ["None", "Class", "Story", "Sex"],
            Item: ["None", "Weapon", "Armor Set", "Head", "Neck", "Shoulders", "Hands", "Waist", "Feet", "Ring", "Top Garb", "Botttom Garb", "Shield"],
            ItemTag: ["Two Hand", "Heavy", "Light", "Bladed", "Thrown", "Ranged", "Melee", "Implement/Catalyst", "Shield", "Skimpy", "Skin Tight", "Metal", "Leather", "Cloth", "Warded", "Calming", "Exp Chest", "Exp Crotch", "Exp Ass", "Conceal"],
            Damage: ["Raw", "Penetrating", "Crushing", "Holy", "Blight", "Acid", "Fire", "Frost", "Storm", "Tease", "Drug", "Pheromone", "Fatigue/Mental"],
            Attack: ["None", "Physical", "Magical", "Mental", "Sexual"],
            // None = -1
            BodyType: ["None", "Unspecified", "Human", "Orc", "Canine", "Feline", "Sylvan/Elf", "Equine", "Vulpine", "Snake", "Mothrine", "Goat", "Swine", "Shark", "Bee", "Draconic", "Kangaroo", "Anemone", "Avian", "Tentacle", "Demonic", "Frog", "Gooey", "Bovine", "Lupine", "Mouse", "Sheep", "Lapine", "Arachnid", "Succubus", "Dove"],
            BodyTag: ["Internal", "Knotted", "Gooey", "Tapered", "Flared", "Blunt", "Prehensile", "Stinger Based", "Stinger Tipped", "Nubby", "Amorphous", "Smooth", "Ribbed", "Foreskinned", "Double Headed", "Thick", "Sticky", "Fluffy", "Lubricated", "Long", "Hollow", "Squishy", "Angular", "Freckled", "Muzzled", "Beak", "Furred", "Tusked", "Refined", "Scaled", "Feathered", "Chitinous", "Aphrodisiac Laced", "Paws", "Digitigrade", "Plantigrade", "Heels", "Hooves", "Sheathed", "Pumped", "Slightly Pumped"],
            // None = -1
            FluidType: ["None", "Unspecified", "Girlcum", "Cum", "Honey", "Milk", "Chocolate Milk", "Strawberry Milk"],
            // None = -1
            SkinType: ["None", "Unspecified", "Latex", "Plant", "Bark", "Fur", "Feathers", "Skin", "Scales", "Chitin", "Goo"],
            // None = -1
            NippleType: ["None", "Unspecified", "Fuckable", "Flat", "Inverted", "Lipples", "Tentacled", "Dick", "Normal"],
            // None = -1
            HairType: ["None", "Unspecified", "Hair", "Plant", "Quills", "Feathers", "Goo", "Tentacles", "Transparent"],
            Weapons: ["None", "CaitsStaff", "Fist", "ShortSword", "CurvedBlade", "Spear", "Pike", "Poleaxe", "Battleaxe", "Francisca", "Javelin", "Quarterstaff", "BladeStaff", "HuntingBow", "WarBow", "Sling"],
            ArmorSet: ["None", "ComfortableClothes", "ScaleArmor", "MailCuirass", "Breastplate", "ApprenticeRobes", "LeatherJerkin", "LeatherCoat", "PassionPriestessGarb"],
            ItemHead: ["None"],
            ItemNeck: ["None", "WardAmulet"],
            ItemShoulders: ["None", "FlameCape", "PriestessCloak"],
            ItemHands: ["None", "Gauntlets", "ArmGuards", "SilverBracelets"],
            ItemWaist: ["None", "PotionBelt"],
            ItemFeet: ["None", "CaitsKneeBoots", "LeatherBoots", "IronGreaves"],
            Rings: ["None", "WizardRing"],
            TopGarb: ["None"],
            BottomGarb: ["None"],
            Shields: ["None", "HoplonShield", "TowerShield", "WickerShield"],
        };

        var negativeGlobals = [globals.BodyType, globals.FluidType, globals.SkinType, globals.NippleType, globals.HairType];

        var charMap = {
            "name": { label: "Name", type: "string" },
            "class": { label: "Class", type: "number", options: globals.Class },
            "background": { label: "Background", type: "number", options: globals.Background },
            "level": { label: "Level", type: "number" },
            "exp": { label: "Exp", type: "number" },
            "hitPoints": { label: "HP", type: "number", groupTag: "Stats" },
            "hitPointsMaxMod": { label: "HP Max Mod", type: "number", groupTag: "Stats" },
            "resolvePoints": { label: "Resolve Points", type: "number", groupTag: "Stats" },
            "resolveMaxMod": { label: "Resolve Points Max Mod", type: "number", groupTag: "Stats" },
            "threatMod": { label: "Threat Mod", type: "number", groupTag: "Stats" },
            "strengthAlloc": { label: "Strength", type: "number", groupTag: "Stats" },
            "strengthMod": { label: "Strength Mod", type: "number", groupTag: "Stats" },
            "toughnessAlloc": { label: "Toughness", type: "number", groupTag: "Stats" },
            "toughnessMod": { label: "Toughness Mod", type: "number", groupTag: "Stats" },
            "agilityAlloc": { label: "Agility", type: "number", groupTag: "Stats" },
            "agilityMod": { label: "Agility Mod", type: "number", groupTag: "Stats" },
            "cunningAlloc": { label: "Cunning", type: "number", groupTag: "Stats" },
            "cunningMod": { label: "Cunning Mod", type: "number", groupTag: "Stats" },
            "willpowerAlloc": { label: "Willpower", type: "number", groupTag: "Stats" },
            "willpowerMod": { label: "Willpower Mod", type: "number", groupTag: "Stats" },
            "presenceAlloc": { label: "Presence", type: "number", groupTag: "Stats" },
            "presenceMod": { label: "Presence Mod", type: "number", groupTag: "Stats" },
            "libidoMod": { label: "Libido Mod", type: "number", groupTag: "Stats" },
            "corruptionMod": { label: "Corruption Mod", type: "number", groupTag: "Stats" },
            "penetratingResist": { label: "Penetrating", type: "number", groupTag: "Stats.Resistance" },
            "crushingResist": { label: "Crushing", type: "number", groupTag: "Stats.Resistance" },
            "holyResist": { label: "Holy", type: "number", groupTag: "Stats.Resistance" },
            "blightResist": { label: "Blight", type: "number", groupTag: "Stats.Resistance" },
            "acidResist": { label: "Acid", type: "number", groupTag: "Stats.Resistance" },
            "fireResist": { label: "Fire", type: "number", groupTag: "Stats.Resistance" },
            "frostResist": { label: "Frost", type: "number", groupTag: "Stats.Resistance" },
            "stormResist": { label: "Storm", type: "number", groupTag: "Stats.Resistance" },
            "raceAffinities": { label: "Race", type: "object", arrayMap: { type: "number", options: globals.Affinity }, groupTag: "Affinities" },
            "classAffinities": { label: "Class", type: "object", arrayMap: { type: "number", options: globals.Affinity }, groupTag: "Affinities" },
            "backgroundAffinities": { label: "Background", type: "object", arrayMap: { type: "number", options: globals.Affinity }, groupTag: "Affinities" },
            "perks": {
                label: "Perks",
                type: "object",
                groupTag: "Effects",
                arrayMap: {
                    "name": { label: "Name", type: "string" },
                    "desc": { label: "Desc", type: "string" },
                    "tag": { label: "Tag", type: "number", options: globals.Perk },
                    "values": { label: "Values", type: "object", arrayMap: { type: "number" } }
                },
                addRemoveOptions: {
                    addFunc: createPerk
                }
            },
            "powers": { label: "Powers", type: "object", arrayMap: { type: "string" }, groupTag: "Effects" },
            "equippedPowers": { label: "Equipped Powers", type: "object", arrayMap: { type: "string" }, groupTag: "Effects" },
            // "stance": "",
            "combatEffects": {
                label: "Combat",
                type: "object",
                arrayMap: {
                    "name": { label: "Name", type: "string" },
                    "short": { label: "Short", type: "string" },
                    "desc": { label: "Desc", type: "string" },
                    "duration": { label: "Duration", type: "number" },
                    "values": { label: "Values", type: "object", arrayMap: { type: "number" } }
                },
                addRemoveOptions: { addFunc: createCombatEffect },
                groupTag: "Effects"
            },
            "statusEffects": {
                label: "Status",
                type: "object",
                arrayMap: {
                    "name": { label: "Name", type: "string" },
                    "desc": { label: "Desc", type: "string" },
                    "duration": { label: "Duration", type: "number" },
                    "values": { label: "Values", type: "object", arrayMap: { type: "number" } }
                },
                addRemoveOptions: { addFunc: createStatusEffect },
                groupTag: "Effects"
            },
            // "boon": null,
            "credits": { label: "Credits", type: "number" },
            "weaponPrimary": { label: "Primary Weapon", type: "string", options: globals.Weapons, groupTag: "Equipment" },
            "weaponSecondary": { label: "Secondary Weapon", type: "string", options: globals.Weapons, groupTag: "Equipment" },
            "head": { label: "Head", type: "string", options: globals.ItemHead, groupTag: "Equipment" },
            "neck": { label: "Neck", type: "string", options: globals.ItemNeck, groupTag: "Equipment" },
            "shoulders": { label: "Shoulders", type: "string", options: globals.ItemShoulders, groupTag: "Equipment" },
            "armorSet": { label: "Armor Set", type: "string", options: globals.ArmorSet, groupTag: "Equipment" },
            "hands": { label: "Hands", type: "string", options: globals.ItemHands, groupTag: "Equipment" },
            "waist": { label: "Waist", type: "string", options: globals.ItemWaist, groupTag: "Equipment" },
            "feet": { label: "Feet", type: "string", options: globals.ItemFeet, groupTag: "Equipment" },
            "rings": { label: "Rings", type: "object", arrayMap: { type: "string", options: globals.Rings }, groupTag: "Equipment" },
            "topGarment": { label: "Top Garment", type: "string", options: globals.TopGarb, groupTag: "Equipment" },
            "bottomGarment": { label: "Bottom Garment", type: "string", options: globals.BottomGarb, groupTag: "Equipment" },
            "inventory": { label: "Inventory", type: "object", arrayMap: { type: "string" } },
            "keyItems": { label: "Key Items", type: "object", arrayMap: { type: "string" } },
            "originalRace": { label: "Original Race", type: "string", groupTag: "Appearance" },
            "femininity": { label: "Feminitity", type: "number", groupTag: "Appearance" },
            "tallness": { label: "Tallness", type: "number", groupTag: "Appearance" },
            "tone": { label: "Tone", type: "number", groupTag: "Appearance" },
            "thickness": { label: "Thickness", type: "number", groupTag: "Appearance" },
            "hipRatingRaw": { label: "Rating Raw", type: "number", groupTag: "Appearance.Hips" },
            "hipRatingMod": { label: "Rating Mod", type: "number", groupTag: "Appearance.Hips" },
            "buttRatingRaw": { label: "Rating Raw", type: "number", groupTag: "Appearance.Butt" },
            "buttRatingMod": { label: "Rating Mod", type: "number", groupTag: "Appearance.Butt" },
            "bellyRatingRaw": { label: "Rating Raw", type: "number", groupTag: "Appearance.Belly" },
            "bellyRatingMod": { label: "Rating Mod", type: "number", groupTag: "Appearance.Belly" },
            "lipMod": { label: "Mod", type: "number", groupTag: "Appearance.Lips" },
            "hairColor": { label: "Color", type: "string", groupTag: "Appearance.Hair" },
            "skinColor": { label: "Skin Color", type: "string", groupTag: "Appearance.Skin" },
            "furColor": { label: "Fur Color", type: "string", groupTag: "Appearance.Skin" },
            "scaleColor": { label: "Scale Color", type: "string", groupTag: "Appearance.Skin" },
            "lipColor": { label: "Color", type: "string", groupTag: "Appearance.Lips" },
            "hairLength": { label: "Length", type: "number", groupTag: "Appearance.Hair" },
            "hairStyle": { label: "Style", type: "string", groupTag: "Appearance.Hair" },
            "hairType": { label: "Type", type: "number", options: globals.HairType, groupTag: "Appearance.Hair" },
            "horns": { label: "Count", type: "number", groupTag: "Appearance.Horns" },
            "hornType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Appearance.Horns" },
            "hornLength": { label: "Length", type: "number", groupTag: "Appearance.Horns" },
            "wingType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Appearance.Wings" },
            "wingCount": { label: "Count", type: "number", groupTag: "Appearance.Wings" },
            "skinType": { label: "Type", type: "number", options: globals.SkinType, groupTag: "Appearance.Skin" },
            "skinTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Appearance.Skin" },
            // "skinTags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag }, groupTag: "Appearance.Skin" },
            "tailType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Appearance.Tails" },
            "numTails": { label: "Count", type: "number", groupTag: "Appearance.Tails" },
            "tailTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Appearance.Tails" },
            // "tailTags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag }, groupTag: "Appearance.Tails" },
            "armType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Appearance.Arms" },
            "armTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Appearance.Arms" },
            // "armTags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag }, groupTag: "Appearance.Arms" },
            "legCount": { label: "Count", type: "number", groupTag: "Appearance.Legs" },
            "legType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Appearance.Legs" },
            "legTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Appearance.Legs" },
            // "legTags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag }, groupTag: "Appearance.Legs" },
            "tongueType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Appearance.Tongue" },
            "tongueTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Appearance.Tongue" },
            // "tongueTags": { label: "Tags", arrayMap: { type: "number", options: globals.BodyTag }, groupTag: "Appearance.Tongue" },
            "faceType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Appearance.Face" },
            "faceTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Appearance.Face" },
            // "faceTags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag }, groupTag: "Appearance.Face" },
            "earType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Appearance.Ears" },
            "earTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Appearance.Ears" },
            // "earTags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag }, groupTag: "Appearance.Ears" },
            "earLength": { label: "Count", type: "number", groupTag: "Appearance.Ears" },
            "eyeType": { label: "Type", type: "number", options: globals.BodyType, groupTag: "Appearance.Eyes" },
            "eyeTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Appearance.Eyes" },
            // "eyeTags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag }, groupTag: "Appearance.Eyes" },
            "eyeColor": { label: "Color", type: "string", groupTag: "Appearance.Eyes" },
            "exhibRaw": { label: "Exhibition Raw", type: "number", groupTag: "Stats" },
            "isVirgin": { label: "Virgin", type: "boolean", groupTag: "Virginity" },
            "vaginalVirgin": { label: "Vaginal", type: "boolean", groupTag: "Virginity" },
            "cockVirgin": { label: "Cock", type: "boolean", groupTag: "Virginity" },
            "analVirgin": { label: "Anal", type: "boolean", groupTag: "Virginity" },
            "pregnancySpeedRaw": { label: "Speed Raw", type: "number", groupTag: "Pregnancy" },
            "pregnancySpeedMod": { label: "Speed Mod", type: "number", groupTag: "Pregnancy" },
            "breastRows": {
                label: "Row",
                type: "object",
                groupTag: "Breasts",
                arrayMap: {
                    "breasts": { label: "Count", type: "number" },
                    "type": { label: "Type", type: "number", options: globals.NippleType },
                    "tags": { label: "Tags", type: "multioption", options: globals.BodyTag },
                    // "tags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag } },
                    "sizeRaw": { label: "Size Raw", type: "number" },
                    "sizeMod": { label: "Size Mod", type: "number" },
                    "lactationBonusMod": { label: "Lacation Bonus Mod", type: "number" },
                    "fullnessRaw": { label: "Fullness Raw", type: "number" },
                },
                addRemoveOptions: {
                    min: 1,
                    addFunc: createBreastRow
                }
            },
            "nippleColor": { label: "Color", type: "string", groupTag: "Breasts.Nipples" },
            "nipplesPerBreast": { label: "Per Breast", type: "number", groupTag: "Breasts.Nipples" },
            "nippleLengthRatio": { label: "Length Ratio", type: "number", groupTag: "Breasts.Nipples" },
            "nippleWidthRatio": { label: "Width Ratio", type: "number", groupTag: "Breasts.Nipples" },
            "milkType": { label: "Type", type: "number", options: globals.FluidType, groupTag: "Breasts.Milk" },
            "milkMultiplier": { label: "Multiplier", type: "number", groupTag: "Breasts.Milk" },
            "milkStorageMultiplier": { label: "Storage Multiplier", type: "number", groupTag: "Breasts.Milk" },
            "milkFullness": { label: "Fullness", type: "number", groupTag: "Breasts.Milk" },
            "milkRate": { label: "Rate", type: "number", groupTag: "Breasts.Milk" },
            "balls": { label: "Count", type: "number", groupTag: "Balls" },
            "ballTags": { label: "Tags", type: "multioption", options: globals.BodyTag, groupTag: "Balls" },
            // "ballTags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag }, groupTag: "Balls" },
            "ballEfficiency": { label: "Efficiency", type: "number", groupTag: "Balls" },
            "ballSizeRaw": { label: "Size Raw", type: "number", groupTag: "Balls" },
            "ballSizeMod": { label: "Size Mod", type: "number", groupTag: "Balls" },
            "ballFullness": { label: "Fullness", type: "number", groupTag: "Balls" },
            "cocks": {
                label: "Cocks",
                type: "object",
                arrayMap: {
                    "type": { label: "Type", type: "number", options: globals.BodyType },
                    "virgin": { label: "Virgin", type: "boolean" },
                    "tags": { label: "Tags", type: "multioption", options: globals.BodyTag },
                    // "tags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag } },
                    "lengthRaw": { label: "Length Raw", type: "number" },
                    "lengthMod": { label: "Length Mod", type: "number" },
                    "thicknessRatioRaw": { label: "Thickness Ratio Raw", type: "number" },
                    "thicknessRatioMod": { label: "Thickness Ratio Mod", type: "number" },
                    "flaccidRatio": { label: "Flaccid Ratio", type: "number" },
                    "knotRatio": { label: "Knot Ratio", type: "number" },
                    "pierced": { label: "Pierced", type: "number" },
                    "color": { label: "Color", type: "string" },
                },
                addRemoveOptions: {
                    addFunc: createCock
                }
            },
            "feracityRaw": { label: "Feracity Raw", type: "number", groupTag: "Stats" },
            "feracityMod": { label: "Feracity Mod", type: "number", groupTag: "Stats" },
            "vagina": {
                label: "Vagina",
                type: "object",
                "type": { label: "Type", type: "number", options: globals.BodyType },
                "hymen": { label: "Hymen", type: "boolean" },
                "clits": { label: "Clits", type: "number" },
                "color": { label: "Color", type: "string" },
                "wetnessRaw": { label: "Wetness Raw", type: "number" },
                "wetnessMod": { label: "Wetness Mod", type: "number" },
                "loosenessRaw": { label: "Looseness Raw", type: "number" },
                "loosenessMod": { label: "Looseness Mod", type: "number" },
                "bonusCapacity": { label: "Bonus Capacity", type: "number" },
                "stretchCounter": { label: "Stretch Counter", type: "number" },
                "tags": { label: "Tags", type: "multioption", options: globals.BodyTag },
                // "tags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag } },
                addRemoveOptions: {
                    max: 1,
                    addFunc: createVagina
                }
            },
            "clitLength": { label: "Length", type: "number", groupTag: "Clit" },
            "girlCumType": { label: "Girl Cum Type", type: "number", options: globals.FluidType, groupTag: "Cum" },
            "cumType": { label: "Cum Type", type: "number", options: globals.FluidType, groupTag: "Cum" },
            "cumMultiplierRaw": { label: "Cum Multiplier Raw", type: "number", groupTag: "Cum" },
            "cumMultiplierMod": { label: "Cum Multiplier Mod", type: "number", groupTag: "Cum" },
            "ass": {
                label: "Butt",
                type: "object",
                "type": { label: "Type", type: "number", options: globals.BodyType },
                "hymen": { label: "Hymen", type: "boolean" },
                "clits": { label: "Clits", type: "number" },
                "color": { label: "Color", type: "string" },
                "wetnessRaw": { label: "Wetness Raw", type: "number" },
                "wetnessMod": { label: "Wetness Mod", type: "number" },
                "loosenessRaw": { label: "Looseness Raw", type: "number" },
                "loosenessMod": { label: "Looseness Mod", type: "number" },
                "bonusCapacity": { label: "Bonus Capacity", type: "number" },
                "stretchCounter": { label: "Stretch Counter", type: "number" },
                "tags": { label: "Tags", type: "multioption", options: globals.BodyTag },
                // "tags": { label: "Tags", type: "object", arrayMap: { type: "number", options: globals.BodyTag } },
            },
            "title": { label: "Title", type: "string" },
            // "wyldMark": -1,
            // "drinks": [],
            "customImage": { label: "Custom Image", type: "string" },
            // "pendingLoot": []
        };

        //
        // Default create functions
        //

        function createCock() {
            return {
                type: 0,
                virgin: true,
                tags: [],
                lengthRaw: 5,
                lengthMod: 0,
                thicknessRatioRaw: 1,
                thicknessRatioMod: 0,
                flaccidRatio: .4,
                knotRatio: 1,
                pierced: 0,
                color: "pink"
            };
        }

        function createVagina() {
            return {
                type: 0,
                hymen: true,
                clits: 1,
                color: "pink",
                wetnessRaw: 1,
                wetnessMod: 0,
                loosenessRaw: 1,
                loosenessMod: 0,
                bonusCapacity: 0,
                stretchCounter: 0,
                tags: []
            };
        }

        function createBreastRow() {
            return {
                breasts: 2,
                type: 0,
                tags: [],
                sizeRaw: 0,
                sizeMod: 0,
                lactationBonusMod: 0,
                fullnessRaw: 0
            };
        }

        function createPerk() {
            return {
                name: "Not A Perk",
                desc: "Not A Perk",
                tag: 0,
                values: [0, 0, 0, 0, 0]
            }
        }

        function createCombatEffect() {
            return {
                name: "Not A CombatEffect",
                short: "Not A CombatEffect",
                desc: "Not A CombatEffect",
                duration: 10000,
                values: [0, 0, 0, 0, 0]
            }
        }

        function createStatusEffect() {
            return {
                name: "Not A StatusEffect",
                desc: "Not A StatusEffect",
                duration: 10000,
                values: [0, 0, 0, 0, 0]
            }
        }

        //
        // Create Elements
        //

        function createTextInput(initialValue, className, changeFunc) {
            var textAreaEl = document.createElement("input");
            textAreaEl.type = "text";
            textAreaEl.className = className;
            textAreaEl.value = initialValue;
            if (changeFunc)
                textAreaEl.addEventListener("change", changeFunc);
            return textAreaEl;
        }

        function createCheckBox(checked, className, changeFunc) {
            var checkBoxEl = document.createElement("input");
            checkBoxEl.className = className;
            checkBoxEl.checked = checked;
            checkBoxEl.type = "checkbox";
            if (changeFunc)
                checkBoxEl.addEventListener("change", changeFunc);
            return checkBoxEl;
        }

        function createPanel() {
            var panel = document.createElement("div");
            panel.className = "panel";
            return panel;
        }

        function createAccordButton(text, panelEl, onClickFunc, clearOtherTabs = false) {
            var accordButton = document.createElement("button");
            accordButton.innerText = text;
            accordButton.className = "accordion";
            accordButton.addEventListener("click", function accordClick() {
                if (this.className && clearOtherTabs) {
                    var otherTabs = this.parentElement.getElementsByClassName(this.className);
                    for (var i = 0; i < otherTabs.length; i++) {
                        otherTabs[i].className = otherTabs[i].className.replace(" active", "");
                    }
                }
                this.classList.toggle("active");
                if (panelEl) {
                    var panel = panelEl;
                    panel.style.display = panel.style.display === "none" || panel.style.display === "" ? "block" : "none";
                }
                if (onClickFunc)
                    onClickFunc(panel);
            });
            return accordButton;
        }

        //
        // On Click Top Tab Functions
        //

        function clearElement(el) {
            while (el.lastElementChild) {
                el.removeChild(el.lastElementChild);
            }
        }

        function generateCharList(obj, el) {
            var container = document.createElement("div");
            el.appendChild(container);
            container.className = "charContainer";
            var charList = document.createElement("div");
            container.appendChild(charList);
            charList.className = "charList";
            var charDesc = document.createElement("div");
            container.appendChild(charDesc);
            charDesc.className = "charDesc";
            Object.keys(obj.chars).forEach(function charKeys(key) {
                var charListEntry = createAccordButton(key, charDesc, function onClickCharDesc(panel) {
                    clearElement(panel);
                    var charKey = key;
                    if (!window.obj)
                        alert("No Save loaded");
                    else if (!window.obj.chars)
                        alert("No Characters in save");
                    else if (!window.obj.chars[charKey])
                        alert("Character " + charKey + " not found");
                    else {
                        panel.style.display = "block";
                        generateMappedFields(window.obj.chars[charKey], panel, charMap);
                    }
                }, true);
                charListEntry.className += " charListEntry";
                charList.appendChild(charListEntry);
            });
        }

        function onClickCharTab(panel) {
            clearElement(panel);
            panel.style.display = "block";
            if (!window.obj)
                alert("No Save File loaded");
            else
                generateCharList(window.obj, panel);
        }

        function onClickFlagTab(panel) {
            clearElement(panel);
            panel.style.display = "block";
            if (!window.obj)
                alert("No Save File loaded");
            else if (!window.obj.flags)
                alert("No Flags in save file");
            else
                generateFields(window.obj.flags, panel);
        }

        function onClickRawTab(panel) {
            clearElement(panel);
            panel.style.display = "block";
            if (!window.obj)
                alert("No Save File loaded");
            else
                generateFields(window.obj, panel);
        }

        function onClickLoadTab(panel) {
            panel.click();
        }

        function onClickSaveTab(panel) {
            if (fileReader) {
                panel.href = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(window.obj));
                panel.download = file.name;
                panel.click();
            }
            else {
                alert("No Save File loaded");
            }
        }

        //
        // File Reading and Object Loading
        //

        var file;
        var fileReader;
        function handleFiles(event) {
            file = event.srcElement.files[0];
            fileReader = new FileReader();
            fileReader.readAsBinaryString(file);
            fileReader.addEventListener("loadend", function () {
                var obj = JSON.parse(fileReader.result);
                loadObj(obj);
            });
        }

        function loadObj(obj) {
            window.obj = obj;
        }

        //
        // Page creation
        //

        document.addEventListener("DOMContentLoaded", () => {
            var tabs = document.createElement("div");
            tabs.className = "tabs";
            document.body.appendChild(tabs);

            var content = document.createElement("div");
            content.className = "mainTabContent tabcontent";
            content.id = "mainContent";
            document.body.appendChild(content);

            var charTab = createAccordButton("Characters", content, onClickCharTab, true);
            charTab.className += " tab";
            tabs.appendChild(charTab);

            var flagTab = createAccordButton("Flags", content, onClickFlagTab, true);
            flagTab.className += " tab";
            tabs.appendChild(flagTab);

            var rawTab = createAccordButton("Raw", content, onClickRawTab, true);
            rawTab.className += " tab";
            tabs.appendChild(rawTab);

            var input = document.createElement("input");
            input.id = "load";
            input.type = "file";
            input.style.display = "none";
            input.addEventListener("change", handleFiles);
            var loadTab = createAccordButton("Load", input, onClickLoadTab, true);
            loadTab.className += " tab";
            loadTab.appendChild(input);
            tabs.appendChild(loadTab);

            var saveLink = document.createElement("a");
            saveLink.id = "saveLink";
            var saveTab = createAccordButton("Save", saveLink, onClickSaveTab, true);
            saveTab.className += " tab";
            saveTab.appendChild(saveLink);
            tabs.appendChild(saveTab);
        });

        //
        // Set Callbacks
        //

        function setNumberCallback(obj, key) {
            return (evnt) => { obj[key] = +evnt.srcElement.value; }
        }

        function setNegNumberCallback(obj, key) {
            return (evnt) => { obj[key] = +evnt.srcElement.value - 1; }
        }

        function setStringCallback(obj, key) {
            return (evnt) => { obj[key] = evnt.srcElement.value; }
        }

        function setSelectorStringCallback(obj, key) {
            return (evnt) => { obj[key] = evnt.srcElement[+evnt.srcElement.value].innerText === "None" ? null : evnt.srcElement[+evnt.srcElement.value].innerText; }
        }

        function setBooleanCallback(obj, key) {
            return (evnt) => obj[key] = evnt.srcElement.checked;
        }

        function setMultiOptionCallback(obj, key) {
            return (evnt) => {
                var fieldset = evnt.path.find(function findFieldSet(value) { if (value.type === "fieldset") return value; });
                var list = fieldset.getElementsByTagName("input");
                var list = Array.from(fieldset.getElementsByTagName("input")).filter(el => el.checked);
                console.log(evnt);
                list.forEach(el => console.log(el.value + " " + el.name + " " + el.checked));
                obj[key] = list.map(el => +el.value);
            };
        }

        //
        // Fields
        //

        function fieldTitle(key) {
            var title = document.createElement("div");
            title.className = "fieldTitle";
            title.textContent = key;
            return title;
        }

        function fieldLabelNoInteract(key) {
            var entry = document.createElement("div");
            entry.className = "accordion fieldEntry";
            var title = fieldTitle(key);
            entry.appendChild(title);
            return entry;
        }

        function fieldLabel(key) {
            var entry = document.createElement("label");
            entry.className = "accordion fieldEntry";
            var title = fieldTitle(key);
            entry.appendChild(title);
            return entry;
        }

        function objectField(text, panel) {
            var accordButton = createAccordButton("", panel);
            var closed = "⬥ ", open = "⬦ ";
            accordButton.className += " fieldTitle";
            accordButton.innerText = closed + text;
            accordButton.addEventListener("click", function nameChanger() {
                this.innerText = this.innerText.startsWith(closed) ? this.innerText.replace(closed, open) : this.innerText.replace(open, closed);
            });
            return accordButton;
        }

        function stringField(name, initialValue, changeFunc) {
            var div = fieldLabel(name);
            var input = createTextInput(initialValue, "", changeFunc);
            div.appendChild(input);
            return div;
        }

        function booleanField(name, initialValue, changeFunc) {
            var div = fieldLabel(name);
            var input = createCheckBox(initialValue, "", changeFunc);
            div.appendChild(input);
            return div;
        }

        function selectField(name, initialValue, options, changeFunc) {
            var div = fieldLabel(name);
            var selector = document.createElement("select");
            options.forEach((value, index) => {
                var option = document.createElement("option");
                option.value = index;
                option.innerText = value;
                if (initialValue + (negativeGlobals.filter(v => v === options).length > 0 ? 1 : 0) === index || initialValue === value)
                    option.selected = "selected";
                selector.appendChild(option);
            });
            selector.addEventListener("change", changeFunc);
            div.appendChild(selector);
            return div;
        }

        function multiOptionField(name, obj, key, options, changeFunc) {
            var div = fieldLabelNoInteract(name);
            var fieldSetEl = document.createElement("fieldset");
            fieldSetEl.addEventListener("click", setMultiOptionCallback(obj, key));
            options.forEach((option, index) => {
                var selected = obj[key].reduce((prev, curr) => prev = prev || (index === curr), false);
                var label = fieldLabel(option);
                label.className += " multioption" + (selected ? " selected" : "");
                var checkbox = createCheckBox(selected, "superhide", function callback() {
                    this.parentElement.classList.toggle("selected");
                });
                checkbox.value = options.indexOf(option);
                checkbox.name = option;
                label.appendChild(checkbox);
                fieldSetEl.appendChild(label);
            });
            fieldSetEl.addEventListener("change", changeFunc);
            div.appendChild(fieldSetEl);
            return div;
        }

        function processInfo(tags, info) {
            var objValue = info.obj[info.key];
            var mapValue = info.map[info.key] ? info.map[info.key] : info.map.arrayMap;
            var parentElement = info.element;
            if (mapValue) {
                var label = mapValue.label ? mapValue.label : info.key;
                if (mapValue.groupTag) {
                    mapValue.groupTag.split(".").reduce(function (parentTag, curTag) {
                        if (!parentTag[curTag]) {
                            var panel = createPanel();
                            parentElement.appendChild(objectField(curTag, panel));
                            parentElement.appendChild(panel);
                            parentTag[curTag] = panel;
                        }
                        parentElement = parentTag[curTag];
                        return parentTag[curTag];
                    }, tags);
                }

                var typeValue = typeof objValue;
                if (objValue === null)
                    typeValue = mapValue.type;

                if (typeValue === "object") {
                    if (mapValue.type === "multioption" && mapValue.options) {
                        parentElement.appendChild(multiOptionField(label, info.obj, info.key, mapValue.options));
                    }
                    else {
                        var panel = createPanel();

                        if (mapValue.addRemoveOptions) {
                            var addRemoveButtons = document.createElement("div");
                            addRemoveButtons.className = "addRemoveButtons";
                            var add = document.createElement("div");
                            add.innerText = "+";
                            add.className = "addRemoveButton accordion";
                            var remove = document.createElement("div");
                            remove.innerText = "–";
                            remove.className = "addRemoveButton accordion";
                            addRemoveButtons.appendChild(add);
                            addRemoveButtons.appendChild(remove);
                            panel.appendChild(addRemoveButtons);

                            add.addEventListener("click", function arrayAddCallback(tags, parent, obj, key, map) {
                                return () => {
                                    if (obj[key] === null) {
                                        obj[key] = map.addRemoveOptions.addFunc();
                                        generateMappedFields(obj[key], parent, map, tags);
                                    }
                                    else {
                                        if (!map.addRemoveOptions.max || (map.addRemoveOptions.max && obj[key].length < map.addRemoveOptions.max)) {
                                            obj[key].push(map.addRemoveOptions.addFunc());
                                            var queue = processInfo(tags, {
                                                obj: obj[key],
                                                key: obj[key].length - 1,
                                                element: parent,
                                                map: map,
                                            });
                                            while (queue.length > 0) {
                                                var results = processInfo(tags, queue.pop());
                                                if (results)
                                                    queue = queue.concat(results);
                                            }
                                        }
                                    }
                                }
                            }(tags, panel, info.obj, info.key, mapValue));

                            remove.addEventListener("click", function arrayRemoveCallback(parent, obj, key, map) {
                                return () => {
                                    if (obj[key]) {
                                        if (obj[key].length) {
                                            if (obj[key].length > (map.addRemoveOptions.min ? map.addRemoveOptions.min : 0)) {
                                                parent.removeChild(parent.lastChild);
                                                parent.removeChild(parent.lastChild);
                                                obj[key].pop();
                                            }
                                        }
                                        else {
                                            while (parent.lastChild !== parent.firstChild) {
                                                parent.removeChild(parent.lastChild);
                                                obj[key] = null;
                                            }
                                        }
                                    }
                                }
                            }(panel, info.obj, info.key, mapValue));
                        }

                        parentElement.appendChild(objectField(label, panel, objValue, mapValue));
                        parentElement.appendChild(panel);

                        if (objValue)
                            return Object.keys(objValue).reverse().map(function arrayKeys(value) {
                                return {
                                    obj: objValue,
                                    key: value,
                                    element: panel,
                                    map: mapValue,
                                };
                            });

                    }
                }
                else if (typeValue === "string") {
                    if (mapValue.options)
                        parentElement.appendChild(selectField(label, objValue, mapValue.options, setSelectorStringCallback(info.obj, info.key)));
                    else
                        parentElement.appendChild(stringField(label, objValue, setStringCallback(info.obj, info.key)));
                }
                else if (typeValue === "number") {
                    if (mapValue.options) {
                        if (negativeGlobals.filter(v => v === mapValue.options).length > 0)
                            parentElement.appendChild(selectField(label, objValue, mapValue.options, setNegNumberCallback(info.obj, info.key)));
                        else
                            parentElement.appendChild(selectField(label, objValue, mapValue.options, setNumberCallback(info.obj, info.key)));
                    }
                    else
                        parentElement.appendChild(stringField(label, objValue, setNumberCallback(info.obj, info.key)));
                }
                else if (typeValue === "boolean") {
                    parentElement.appendChild(booleanField(label, objValue, setBooleanCallback(info.obj, info.key)));
                }
            }
        }

        function generateMappedFields(obj, element, map, tags) {
            if (!map)
                return;
            var queue = [];
            Object.keys(obj).reverse().forEach(function keyQueue(value) {
                queue.push({
                    obj: obj,
                    key: value,
                    element: element,
                    map: map,
                });
            });
            var tags = tags ? tags : {};
            while (queue.length > 0) {
                var results = processInfo(tags, queue.pop());
                if (results)
                    queue = queue.concat(results);
            }
        }

        function generateFields(obj, element) {
            Object.keys(obj).forEach(function fieldKeys(key) {
                switch (typeof obj[key]) {
                    case "string": {
                        element.appendChild(stringField(key, obj[key], setStringCallback(obj, key)));
                        break;
                    }
                    case "number": {
                        element.appendChild(stringField(key, obj[key], setNumberCallback(obj, key)));
                        break;
                    }
                    case "boolean": {
                        element.appendChild(booleanField(key, obj[key], setBooleanCallback(obj, key)));
                        break;
                    }
                    case "object": {
                        if (obj[key] === null)
                            break;
                        var panel = createPanel();
                        element.appendChild(objectField(key, panel));
                        element.appendChild(panel);
                        generateFields(obj[key], panel);
                    }
                }
            });
        }
    </script>
</head>

<body>
</body>